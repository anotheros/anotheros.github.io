/*! MIT license, more info: wgo.waltheri.net */(function(a,r){var n=function(a){var b=new d(JSON.parse(JSON.stringify(a.getProperties()))),q;for(q in a.children)b.appendChild(n(a.children[q]));return b},h=function(a,b){var q;if(b[a]!==r)return b[a];for(var c in b.children)if(q=h(a,b.children[c]))return q;return!1},k=function(a,b){a.push(JSON.parse(JSON.stringify(b.getProperties())));if(1<b.children.length){for(var q=[],c=0;c<b.children.length;c++){var f=[];k(f,b.children[c]);q.push(f)}a.push(q)}else b.children.length&&k(a,b.children[0])},p=function(a,
b){for(var q,c=1;c<a.length;c++)if(a[c].constructor==Array)for(var f=0;f<a[c].length;f++)q=new d(a[c][f][0]),b.appendChild(q),p(a[c][f],q);else q=new d(a[c]),b.insertAfter(q),b=q},e=function(a){return"string"==typeof a?a.replace(/\\/g,"\\\\").replace(/]/g,"\\]"):a},g=function(a,b){return String.fromCharCode(97+a)+String.fromCharCode(97+b)},w=function(a,b,c){if(b.length){c.sgf+=a;for(var q in b)c.sgf+="["+b[q]+"]"}},l=function(b,c){if(b.move){var q="";b.move.pass||(q=g(b.move.x,b.move.y));c.sgf=b.move.c==
a.B?c.sgf+("B["+q+"]"):c.sgf+("W["+q+"]")}if(b.setup){q=[];var f=[],v=[];for(d in b.setup)b.setup[d].c==a.B?q.push(g(b.setup[d].x,b.setup[d].y)):b.setup[d].c==a.W?f.push(g(b.setup[d].x,b.setup[d].y)):v.push(g(b.setup[d].x,b.setup[d].y));w("AB",q,c);w("AW",f,c);w("AE",v,c)}if(b.markup){q={};for(d in b.markup)q[b.markup[d].type]=q[b.markup[d].type]||[],"LB"==b.markup[d].type?q.LB.push(g(b.markup[d].x,b.markup[d].y)+":"+e(b.markup[d].text)):q[b.markup[d].type].push(g(b.markup[d].x,b.markup[d].y));for(var y in q)w(y,
q[y],c)}var d=b.getProperties();for(y in d)"object"!=typeof d[y]&&(c.sgf="turn"==y?c.sgf+("PL["+(d[y]==a.B?"B":"W")+"]"):"comment"==y?c.sgf+("C["+e(d[y])+"]"):c.sgf+(y+"["+e(d[y])+"]"));if(1==b.children.length)c.sgf+="\n;",l(b.children[0],c);else if(1<b.children.length)for(y in b.children)d=b.children[y],q=c,q.sgf+="(\n;",l(d,q),q.sgf+="\n)"},u=function(){this.size=19;this.info={};this.root=new d;this.propertyCount=this.nodeCount=0};u.prototype={constructor:u,clone:function(){var a=new u;a.size=this.size;
a.info=JSON.parse(JSON.stringify(this.info));a.root=n(this.root);a.nodeCount=this.nodeCount;a.propertyCount=this.propertyCount;return a},hasComments:function(){return!!h("comment",this.root)}};u.fromSgf=function(b){return a.SGF.parse(b)};u.fromJGO=function(a){a="string"==typeof a?JSON.parse(a):a;var b=new u;b.info=JSON.parse(JSON.stringify(a.info));b.size=a.size;b.nodeCount=a.nodeCount;b.propertyCount=a.propertyCount;b.root=new d(a.game[0]);p(a.game,b.root);return b};u.prototype.toSgf=function(){var a=
{sgf:"(\n;"},b={},c;for(c in this.info)"black"==c?(this.info.black.name&&(b.PB=e(this.info.black.name)),this.info.black.rank&&(b.BR=e(this.info.black.rank)),this.info.black.team&&(b.BT=e(this.info.black.team))):"white"==c?(this.info.white.name&&(b.PW=e(this.info.white.name)),this.info.white.rank&&(b.WR=e(this.info.white.rank)),this.info.white.team&&(b.WT=e(this.info.white.team))):b[c]=e(this.info[c]);this.size&&(b.SZ=this.size);b.AP||(b.AP="WGo.js:2");b.FF||(b.FF="4");b.GM||(b.GM="1");b.CA||(b.CA=
"UTF-8");for(c in b)b[c]&&(a.sgf+=c+"["+b[c]+"]");l(this.root,a);a.sgf+=")";return a.sgf};u.prototype.toJGO=function(a){var b={};b.size=this.size;b.info=JSON.parse(JSON.stringify(this.info));b.nodeCount=this.nodeCount;b.propertyCount=this.propertyCount;b.game=[];k(b.game,this.root);return a?JSON.stringify(b):b};var x=function(b){if(b.name){var c=a.filterHTML(b.name);b.rank&&(c+=" ("+a.filterHTML(b.rank)+")");b.team&&(c+=", "+a.filterHTML(b.team))}else b.team&&(c=a.filterHTML(b.team)),b.rank&&(c+=
" ("+a.filterHTML(b.rank)+")");return c};u.infoFormatters={black:x,white:x,TM:function(b){if(0==b)return a.t("none");var c,f=Math.floor(b/60);1==f?c="1 "+a.t("minute"):1<f&&(c=f+" "+a.t("minutes"));f=b%60;1==f?c+=" 1 "+a.t("second"):1<f&&(c+=" "+f+" "+a.t("seconds"));return c},RE:function(b){return'<a href="javascript: void(0)" onclick="this.parentNode.innerHTML = \''+a.filterHTML(b)+'\'" title="'+a.t("res-show-tip")+'">'+a.t("show")+"</a>"}};u.infoList="black white AN CP DT EV GN GC HA ON OT RE RO RU SO TM US PC KM".split(" ");
a.Kifu=u;var B=function(a,b,c){for(var f=0;f<a.length;f++)if(a[f].x==b.x&&a[f].y==b.y){a[f][c]=b[c];return}a.push(b)},A=function(a,b){if(a)for(var c=0;c<a.length;c++)if(a[c].x==b.x&&a[c].y==b.y){a.splice(c,1);break}},d=function(a,b){this.parent=b||null;this.children=[];if(a)for(var c in a)this[c]=a[c]};d.prototype={constructor:d,getChild:function(a){a=a||0;return this.children[a]?this.children[a]:null},addSetup:function(a){this.setup=this.setup||[];B(this.setup,a,"c");return this},removeSetup:function(a){A(this.setup,
a);return this},addMarkup:function(a){this.markup=this.markup||[];B(this.markup,a,"type");return this},removeMarkup:function(a){A(this.markup,a);return this},remove:function(){var a=this.parent;if(!a)throw new Exception("Root node cannot be removed");for(var b in a.children)if(a.children[b]==this){a.children.splice(b,1);break}a.children=a.children.concat(this.children);this.parent=null;return a},insertAfter:function(a){for(var b in this.children)this.children[b].parent=a;a.children=a.children.concat(this.children);
a.parent=this;this.children=[a];return a},appendChild:function(a){a.parent=this;this.children.push(a);return a},getProperties:function(){var a={},b;for(b in this)this.hasOwnProperty(b)&&"children"!=b&&"parent"!=b&&"_"!=b[0]&&(a[b]=this[b]);return a}};a.KNode=d;var m=function(a,b){for(var c=a.size,f=[],v=[],q=0;q<c*c;q++)a.schema[q]&&!b.schema[q]?v.push({x:Math.floor(q/c),y:q%c}):a.schema[q]!=b.schema[q]&&f.push({x:Math.floor(q/c),y:q%c,c:b.schema[q]});return{add:f,remove:v}};x=function(b,c,f,v){this.kifu=
b;this.node=this.kifu.root;this.allow_illegal=f||!1;this.game=new a.Game(this.kifu.size,this.allow_illegal?"NONE":"KO",this.allow_illegal,this.allow_illegal);v||(a.mainGame=this.game);this.path={m:0};this.kifu.info.HA&&1<this.kifu.info.HA&&(this.game.turn=a.W);this.change=D(this.game,this.node,!0);this.rememberPath=c?!0:!1};var z=function(a,b){var c=[],f;for(f in a){var v=!0;for(var q in b)if(a[f].x==b[q].x&&a[f].y==b[q].y){v=!1;break}v&&c.push(a[f])}return c},D=function(a,b,c){b.parent&&(b.parent._last_selected=
b.parent.children.indexOf(b));if(b.move!=r){if(b.move.pass)return a.pass(b.move.c),{add:[],remove:[]};a=a.play(b.move.x,b.move.y,b.move.c);if("number"==typeof a)throw new f(a,b);for(var v in a)if(a[v].x==b.move.x&&a[v].y==b.move.y)return{add:[],remove:a};return{add:[b.move],remove:a}}c||a.pushPosition();c=[];var q=[];if(b.setup!=r)for(v in b.setup)b.setup[v].c?(a.setStone(b.setup[v].x,b.setup[v].y,b.setup[v].c),c.push(b.setup[v])):(a.removeStone(b.setup[v].x,b.setup[v].y),q.push(b.setup[v]));b.turn&&
(a.turn=b.turn);return{add:c,remove:q}},c=function(a){a=a||0;var b=this.node.children[a];if(!b)return!1;var c=D(this.game,b);this.path.m++;1<this.node.children.length&&(this.path[this.path.m]=a);this.node=b;return c},b=function(){if(!this.node.parent)return!1;this.node=this.node.parent;this.game.popPosition();this.node.turn&&(this.game.turn=this.node.turn);this.path[this.path.m]!==r&&delete this.path[this.path.m];this.path.m--;return!0},v=function(){this.game.firstPosition();this.node=this.kifu.root;
this.path={m:0};this.kifu.info.HA&&1<this.kifu.info.HA&&(this.game.turn=a.W);this.change=D(this.game,this.node,!0)};x.prototype={constructor:x,next:function(a){this.change=c.call(this,a);return this},last:function(){var a;for(this.change={add:[],remove:[]};a=c.call(this);){var b=this.change;b.add=z(b.add,a.remove).concat(a.add);b.remove=z(b.remove,a.add).concat(a.remove)}return this},previous:function(){var a=this.game.getPosition();b.call(this);this.change=m(a,this.game.getPosition());return this},
first:function(){var a=this.game.getPosition();v.call(this);this.change=m(a,this.game.getPosition());return this},goTo:function(a){if(a===r)return this;var b=this.game.getPosition();v.call(this);for(var f=0;f<a.m&&c.call(this,a[f+1]);f++);this.change=m(b,this.game.getPosition());return this},previousFork:function(){for(var a=this.game.getPosition();b.call(this)&&1==this.node.children.length;);this.change=m(a,this.game.getPosition());return this},getPosition:function(){return this.game.getPosition()},
allowIllegalMoves:function(a){a?(this.game.allow_rewrite=!0,this.game.allow_suicide=!0,this.repeating="NONE"):(this.game.allow_rewrite=!1,this.game.allow_suicide=!1,this.repeating="KO")}};a.KifuReader=x;var f=function(b,c){this.name="InvalidMoveError";this.message="Invalid move in kifu detected. ";if(c.move&&c.move.c!==r&&c.move.x!==r&&c.move.y!==r){var f=c.move.x;7<c.move.x&&f++;String.fromCharCode(f+65);this.message+="Trying to play "+(c.move.c==a.WHITE?"white":"black")+" move on "+String.fromCharCode(c.move.x+
65)+(19-c.move.y)}else this.message+="Move object doesn't contain arbitrary attributes.";if(b)switch(b){case 1:this.message+=", but these coordinates are not on board.";break;case 2:this.message+=", but there already is a stone.";break;case 3:this.message+=", but this move is a suicide.";break;case 4:this.message+=", but this position already occured."}else this.message+="."};f.prototype=Error();f.prototype.constructor=f;a.InvalidMoveError=f;a.i18n.en.show="show";a.i18n.en["res-show-tip"]="Click to show result."})(WGo);(function(a,r){function n(){var a=new Date,e=a.getMonth()+1,d=a.getDate();1<=e&&9>=e&&(e="0"+e);0<=d&&9>=d&&(d="0"+d);return""+a.getFullYear()+e+d+a.getHours()+a.getMinutes()+a.getSeconds()}a.SGF={};var h=19;r=function(a,e,d,g,l,h){e=h==e?"black":"white";d.info[e]=d.info[e]||{};"name"==a?document.documentElement.clientHeight>document.documentElement.clientWidth&&9<k(l[0])?d.info[e][a]=l[0].substring(0,p(l[0])):d.info[e][a]=l[0]:d.info[e][a]=l[0]};var k=function(a){for(var e=0,d=0;d<a.length;d++)e=
null!=a.charAt(d).match(/[^\x00-\xff]/ig)?e+2:e+1;return e},p=function(a){for(var e=0,d=0,g=0;g<a.length&&!(e=null!=a.charAt(g).match(/[^\x00-\xff]/ig)?e+2:e+1,d+=1,9<e);g++);return d},e=function(a){for(var e=0,d=0,g=0;g<a.length&&!(e=null!=a.charAt(g).match(/[^\x00-\xff]/ig)?e+2:e+1,d+=1,20<e);g++);return d},g=a.SGF.properties={};g.B=g.W=function(e,g,d,m){g.move=!d[0]||19>=e.size&&"tt"==d[0]?{pass:!0,c:"B"==m?a.B:a.W}:{x:d[0].charCodeAt(0)-97,y:d[0].charCodeAt(1)-97,c:"B"==m?a.B:a.W}};g.AB=g.AW=
function(e,g,d,m){for(var l in d)g.addSetup({x:d[l].charCodeAt(0)-97,y:d[l].charCodeAt(1)-97,c:"AB"==m?a.B:a.W})};g.AE=function(a,e,d){for(var g in d)e.addSetup({x:d[g].charCodeAt(0)-97,y:d[g].charCodeAt(1)-97})};g.PL=function(e,g,d){g.turn="b"==d[0]||"B"==d[0]?a.B:a.W};g.C=function(a,e,d){e.comment=e.comment?e.comment+("\r\n"+d.join()):d.join();if(a=e.comment)e.comment=a.replace("\n"," ")};g.LZ=function(g,l,d){g=d.toString().split("\n");if(2<=g.length){var m=g[0].split(" ");3==m.length&&(l.engine=
m[0],20<k(m[0])&&(l.enginemin=m[0].substring(0,e(m[0]))),l.comment2="\n\u80dc\u7387:"+m[1]+"\u3000\u603b\u8ba1\u7b97\u91cf:"+m[2]);4==m.length&&(l.engine=m[0],20<k(m[0])&&(l.enginemin=m[0].substring(0,e(m[0]))),l.comment2="\n\u80dc\u7387:"+m[1]+"\u3000\u76ee\u5dee:"+m[3]+"\u3000\u603b\u8ba1\u7b97\u91cf:"+m[2]);g=g[1].split(" info ");l.bestMoves=[];for(var p=m=0,w=0;10>w&&w<g.length;w++)for(var c=g[w].trim().split(" "),b=0;b<c.length;b++){var v=c[b];if("visits"==v){d=c[++b];var f=parseInt(d);p+=f;
f>m&&(m=f)}}for(w=0;10>w&&w<g.length;w++)if(f={},c=g[w].trim().split(" "),2<c.length){for(b=0;b<c.length;b++)if(v=c[b],"pv"==v){d=c.slice(b+1,c.length);for(c=0;c<d.length;c++){var q=d[c],y=q.charCodeAt(0)-97;0>y&&(y+=32);7<y&&y--;var C=q.charCodeAt(1)-48;2<q.length&&(C=10*C+(q.charCodeAt(2)-48));C=h-C;d[c]=y+"_"+C}f.variation=d;break}else d=c[++b],"move"==v&&(f.coordinate=d.toString(),q=d.toString(),y=q.charCodeAt(0)-97,0>y&&(y+=32),7<y&&y--,C=q.charCodeAt(1)-48,2<q.length&&(C=10*C+(q.charCodeAt(2)-
48)),C=h-C,f.x=y,f.y=C),"visits"==v&&(f.playouts=parseInt(d),f.totalplayouts=p,0==l.bestMoves.length?(f.percentplayouts=2.5,f.percentplayouts2=parseInt(d).toFixed(1)/m):(f.percentplayouts=parseInt(d).toFixed(1)/m,f.percentplayouts2=f.percentplayouts)),"winrate"==v&&(f.winrate=parseInt(d)/100),"scoreMean"==v&&(f.scoreMean=parseFloat(d),f.isKataData=!0,a.isKataData||(a.isKataData=!0,a.kataShowMean=!0,a.meanPo&&(a.meanPo.style.display="inline",a.DZ&&(a.kataShowMean=!1,a.meanPo.innerHTML="\u76ee\u5dee"))));
f.coordinate&&l.bestMoves.push(f)}}};g.LB=function(a,e,d){for(var g in d)e.addMarkup({x:d[g].charCodeAt(0)-97,y:d[g].charCodeAt(1)-97,type:"LB",text:d[g].substr(3)})};g.CR=g.SQ=g.TR=g.SL=g.MA=function(a,e,d,g){for(var m in d)e.addMarkup({x:d[m].charCodeAt(0)-97,y:d[m].charCodeAt(1)-97,type:g})};g.SZ=function(a,e,d){a.size=parseInt(d[0]);h=a.size};g.BR=g.WR=r.bind(this,"rank","BR");g.PB=g.PW=r.bind(this,"name","PB");g.BT=g.WT=r.bind(this,"team","BT");g.TM=function(a,e,d,g){a.info[g]=d[0];e.BL=d[0];
e.WL=d[0]};g.DZ=function(e,g,d){"KB"==d[0]?(a.DZ=!0,a.KB=!0):"KW"==d[0]?(a.DZ=!0,a.KW=!0):a.DZ="Y"==d[0]?!0:!1};var w=/\(|\)|(;(\s*[A-Za-z]+\s*((\[\])|(\[(.|\s)*?(([^\\]|[^\\]\\\\)\])))+)*)/g,l=/[A-Z]+\s*((\[\])|(\[(.|\s)*?(([^\\]|[^\\]\\\\)\])))+/g,u=/[A-Z]+/,x=/(\[\])|(\[(.|\s)*?(([^\\]|[^\\]\\\\)\]))/g;a.SGF.parse=function(e){var g=[],d=new a.Kifu,m=null;e=e.match(w);for(var h in e)if("("==e[h])g.push(m);else if(")"==e[h])m=g.pop();else{m&&d.nodeCount++;m=m?m.appendChild(new a.KNode):d.root;var p=
e[h].match(l)||[];d.propertyCount+=p.length;for(var c in p){var b=u.exec(p[c])[0];var v=p[c].match(x);for(var f in v)v[f]=v[f].substring(1,v[f].length-1).replace(/\\(?!\\)/g,"");if(a.SGF.properties[b])a.SGF.properties[b](d,m,v,b);else 1>=v.length&&(v=v[0]),m.parent?m[b]=v:d.info[b]=v}}a.mianKifu=d;for(g=d.root;g.children&&g.children[0];)g=g.children[0],g.children[1]&&g.children[1].move.pass&&g.children[1].children&&g.children[1].children[0]&&(g.children[1].children[0].parent=g,g.children[1]=g.children[1].children[0]);
a.drawWinrate();g=document.getElementById("main2");d.info.black&&d.info.black.name&&d.info.white&&d.info.white.name&&(a.uploader?g.setAttribute("download",a.uploader+"_"+d.info.black.name+"_vs"+d.info.white.name+n()+".sgf"):g.setAttribute("download",d.info.black.name+"_vs_"+d.info.white.name+n()+".sgf"));a.editMoveNum=1;return d}})(WGo);(function(a){var r=function(a,c){this.name="FileError";this.message=1==c?"File '"+a+"' is empty.":2==c?"Network error. It is not possible to read '"+a+"'.":"File '"+a+"' hasn't been found on server."};r.prototype=Error();r.prototype.constructor=r;a.FileError=r;var n=a.loadFromUrl=function(a,c){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4==b.readyState)if(200==b.status){if(0==b.responseText.length)throw new r(a,1);c(b.responseText)}else throw new r(a);};try{b.open("GET",a,!0),b.overrideMimeType("text/html;charset=utf-8"),
b.send()}catch(q){throw new r(a,2);}},h=function(b){b.change&&this.board.update(b.change);this.temp_marks&&this.board.removeObject(this.temp_marks);var c=[];this.notification();a.curNode=b.node;a.badLastMark&&a.curBoard.removeObject(a.badLastMark);a.badLastMark2&&a.curBoard.removeObject(a.badLastMark2);if(1<b.node.children.length&&this.config.displayVariations)for(var f=0;f<b.node.children.length;f++)b.node.children[f].move&&!b.node.children[f].move.pass&&c.push({type:"LB2",text:String.fromCharCode(65+
f),x:b.node.children[f].move.x,y:b.node.children[f].move.y,c:this.board.theme.variationColor||"rgba(0,32,128,0.8)"});if(b.node.markup){for(f in b.node.markup)for(var q=0;q<c.length;q++)b.node.markup[f].x==c[q].x&&b.node.markup[f].y==c[q].y&&(c.splice(q,1),q--);c=c.concat(b.node.markup)}a._last_mark&&this.board.removeAllObjectsVR();this.board.removeAllObjectsBM();this.temp_marks=c;this.board.addObject(c);a.curNode.children[0]&&(f=a.curNode.children[0].move,c={},c.c=a.mainGame.turn,c.x=f.x,c.y=f.y,
c.type="CRS",this.board.addObject(c),a.badLastMark2=c);if(b.node.bestMoves)for(b.node.engine&&(a.isWideMode?a.commentTitle.innerHTML=b.node.enginemin?"\u5f15\u64ce:"+b.node.enginemin:"\u5f15\u64ce:"+b.node.engine:a.engineElement.innerHTML=b.node.enginemin?b.node.enginemin:b.node.engine),f=0;f<b.node.bestMoves.length;f++)c=b.node.bestMoves[f],c.coordinate&&(q={},q.x=c.x,q.y=c.y,q.winrate=c.winrate,q.scoreMean=c.scoreMean,q.playouts=c.playouts,q.percentplayouts=c.percentplayouts,q.type="BM",this.board.addObject(q));
b.node.move&&this.config.markLastMove&&(b.node.move.pass?this.notification(a.t((b.node.move.c==a.B?"b":"w")+"pass")):(f={},f.type=a.editMode?"CR2":"TRS",f.x=b.node.move.x,f.y=b.node.move.y,a.curBoard.addObject(f)));a.drawWinrate2()},k=function(a){this.board.setSize(a.kifu.size);this.board.removeAllObjects();this.config.enableWheel&&this.setWheel(!0);this.setOpenKey()},p=function(a,c){return a==c.element||a==c.element?!1:a._wgo_scrollable||a.scrollHeight>a.offsetHeight&&"auto"==window.getComputedStyle(a).overflow?
!0:p(a.parentNode,c)},e=function(a){var b=a.wheelDelta||-1*a.detail;return p(a.target,this)?!0:0>b?(this.next(),this.config.lockScroll&&a.preventDefault&&a.preventDefault(),!this.config.lockScroll):0<b?(this.previous(),this.config.lockScroll&&a.preventDefault&&a.preventDefault(),!this.config.lockScroll):!0},g=function(a){if(document.querySelector("input:focus, textarea:focus"))return!0;switch(a.keyCode){case 39:this.next();break;case 37:this.previous();break;default:return!0}this.config.lockScroll&&
a.preventDefault&&a.preventDefault();return!this.config.lockScroll},w=function(a,c){if(!this.kifuReader||!this.kifuReader.node)return!1;for(var b in this.kifuReader.node.children)if(this.kifuReader.node.children[b].move&&this.kifuReader.node.children[b].move.x==a&&this.kifuReader.node.children[b].move.y==c){this.next(b);break}},l=function(b){this.config=b;for(var c in l.default)void 0===this.config[c]&&void 0!==l.default[c]&&(this.config[c]=l.default[c]);this.element=document.createElement("div");
this.board=new a.Board(this.element,this.config.board);this.init();this.initGame()},u,x=function(b,c){if(!a.commentVarClicked&&(a.lastX!=b||a.lastY!=c))if(a.lastX=b,a.lastY=c,u&&(clearInterval(u),u=null),a._last_mark&&this.board.removeAllObjectsVR(),-1!=b&&-1!=c){var f=!1;if(a.curNode.bestMoves){for(var v=a.curNode.bestMoves,d,e=0;e<v.length;e++)if(d=v[e],d.x==b&&d.y==c){f=!0;break}if(f)for(a.isMouseOnBestMove=!0,a.mouseBestMove=d,this.board.removeAllObjectsBM(d.x,d.y),a.badLastMark&&this.board.removeObject(a.badLastMark),
a.badLastMark2&&this.board.removeObject(a.badLastMark2),b={},b.c=a.mainGame.turn,b.x=d.x,b.y=d.y,b.winrate=d.winrate,b.scoreMean=d.scoreMean,b.playouts=d.playouts,b.percentplayouts=d.percentplayouts,b.type="BM",this.board.addObject(b),a._last_mark=!0,d=d.variation,a.var_length=d.length,a.display_var_length=a.isAutoMode?1:-1,e=1;e<d.length;e++)b=d[e].split("_"),this.board.addObject({type:"variation",x:b[0],y:b[1],c:a.mainGame.turn,num:e+1});else if(a.isMouseOnBestMove=!1,a.curNode.children[0]&&(e=
a.curNode.children[0].move,d={},d.c=a.mainGame.turn,d.x=e.x,d.y=e.y,d.type="CRS",this.board.addObject(d),a.badLastMark2=d),a._last_mark){d=a.curNode;if(d.bestMoves)for(e=0;e<d.bestMoves.length;e++)c=d.bestMoves[e],c.coordinate&&(b={},b.x=c.x,b.y=c.y,b.scoreMean=c.scoreMean,b.winrate=c.winrate,b.playouts=c.playouts,b.percentplayouts=c.percentplayouts,b.type="BM",this.board.addObject(b));a.editMode||(e={type:"TRS"},e.x=d.move.x,e.y=d.move.y,this.board.addObject(e));a._last_mark=!1}}}else if(a.isMouseOnBestMove=
!1,a.curNode.children[0]&&(e=a.curNode.children[0].move,d={},d.c=a.mainGame.turn,d.x=e.x,d.y=e.y,d.type="CRS",this.board.addObject(d),a.badLastMark2=d),a._last_mark){d=a.curNode;if(d.bestMoves)for(e=0;e<d.bestMoves.length;e++)c=d.bestMoves[e],c.coordinate&&(b={},b.x=c.x,b.scoreMean=c.scoreMean,b.y=c.y,b.winrate=c.winrate,b.playouts=c.playouts,b.percentplayouts=c.percentplayouts,b.type="BM",this.board.addObject(b));a._last_mark=!1}},B=function(){if(!a.editMode)if(a.commentVarClicked){a.commentVarClicked=
!1;a.lastX=-1;a.lastY=-1;a.clickedComment=!1;a.isMouseOnBestMove=!1;a.curBoard.removeAllObjectsVR();var b=a.curNode;if(b.bestMoves)for(var c=0;c<b.bestMoves.length;c++){var f=b.bestMoves[c];if(f.coordinate){var d={};d.x=f.x;d.y=f.y;d.scoreMean=f.scoreMean;d.winrate=f.winrate;d.playouts=f.playouts;d.percentplayouts=f.percentplayouts;d.type="BM";a.curBoard.addObject(d)}}c={type:"TRS"};c.x=b.move.x;c.y=b.move.y;this.board.addObject(c);a.curBoard.redraw()}else a.isMouseOnBestMove&&(a.display_var_length&&
(a.display_var_length=2),a.curBoard.redrawVar(),u=setInterval(function(){0>a.display_var_length&&(a.display_var_length=1);a.display_var_length<a.var_length&&a.display_var_length++;a.curBoard.redrawVar()},700))},A=function(b,c){if(a.lastX==b&&a.lastY==c&&a.isMouseOnBestMove){this.board.removeAllObjectsVR();a.isMouseOnBestMove=!1;if(a.curNode.children[0]){var f=a.curNode.children[0].move,d={};d.c=a.mainGame.turn;d.x=f.x;d.y=f.y;d.type="CRS";this.board.addObject(d);a.badLastMark2=d}if(a._last_mark){d=
a.curNode;if(d.bestMoves)for(f=0;f<d.bestMoves.length;f++)c=d.bestMoves[f],c.coordinate&&(b={},b.x=c.x,b.y=c.y,b.scoreMean=c.scoreMean,b.winrate=c.winrate,b.playouts=c.playouts,b.percentplayouts=c.percentplayouts,b.type="BM",this.board.addObject(b));a._last_mark=!1}a.lastX=-1;a.lastY=-1}else if(a.lastX=b,a.lastY=c,a._last_mark&&this.board.removeAllObjectsVR(),-1!=b&&-1!=c){var e=!1,v=a.curNode.bestMoves;for(f=0;f<v.length;f++)if(d=v[f],d.x==b&&d.y==c){e=!0;break}if(!e)for(f=0;f<v.length;f++)if(d=
v[f],!(d.x!==b+1&&d.x!==b&&d.x!==b-1||d.y!==c&&d.y!==c+1&&d.y!==c-1)){var g=d.x-b+d.y-c;if(2!==g&&0!==g&&-2!==g){e=!0;break}}if(!e)for(f=0;f<v.length;f++)if(d=v[f],!(d.x!==b+1&&d.x!==b&&d.x!==b-1||d.y!==c&&d.y!==c+1&&d.y!==c-1)){e=!0;break}if(e)if(a.mouseBestMove==d&&a.isMouseOnBestMove){a.isMouseOnBestMove=!1;a.curNode.children[0]&&(f=a.curNode.children[0].move,d={},d.c=a.mainGame.turn,d.x=f.x,d.y=f.y,d.type="CRS",this.board.addObject(d),a.badLastMark2=d);if(a._last_mark){d=a.curNode;if(d.bestMoves)for(f=
0;f<d.bestMoves.length;f++)c=d.bestMoves[f],c.coordinate&&(b={},b.x=c.x,b.y=c.y,b.scoreMean=c.scoreMean,b.winrate=c.winrate,b.playouts=c.playouts,b.percentplayouts=c.percentplayouts,b.type="BM",this.board.addObject(b));a._last_mark=!1}a.lastX=-1;a.lastY=-1}else for(a.isMouseOnBestMove=!0,a.mouseBestMove=d,this.board.removeAllObjectsBM(d.x,d.y),a.badLastMark&&this.board.removeObject(a.badLastMark),a.badLastMark2&&this.board.removeObject(a.badLastMark2),b={},b.c=a.mainGame.turn,b.x=d.x,b.y=d.y,b.winrate=
d.winrate,b.scoreMean=d.scoreMean,b.playouts=d.playouts,b.percentplayouts=d.percentplayouts,b.type="BM",this.board.addObject(b),a._last_mark=!0,d=d.variation,a.var_length=d.length,a.display_var_length=a.isAutoMode?1:-1,f=1;f<d.length;f++)b=d[f].split("_"),this.board.addObject({type:"variation",x:b[0],y:b[1],c:a.mainGame.turn,num:f+1});else if(a.isMouseOnBestMove=!1,a.curNode.children[0]&&(f=a.curNode.children[0].move,d={},d.c=a.mainGame.turn,d.x=f.x,d.y=f.y,d.type="CRS",this.board.addObject(d),a.badLastMark2=
d),a._last_mark){d=a.curNode;if(d.bestMoves)for(f=0;f<d.bestMoves.length;f++)c=d.bestMoves[f],c.coordinate&&(b={},b.x=c.x,b.y=c.y,b.scoreMean=c.scoreMean,b.winrate=c.winrate,b.playouts=c.playouts,b.percentplayouts=c.percentplayouts,b.type="BM",this.board.addObject(b));a.editMode||(f={type:"TRS"},f.x=d.move.x,f.y=d.move.y,this.board.addObject(f));a._last_mark=!1}}else if(a.isMouseOnBestMove=!1,a.curNode.children[0]&&(f=a.curNode.children[0].move,d={},d.c=a.mainGame.turn,d.x=f.x,d.y=f.y,d.type="CRS",
this.board.addObject(d),a.badLastMark2=d),a._last_mark){d=a.curNode;if(d.bestMoves)for(f=0;f<d.bestMoves.length;f++)c=d.bestMoves[f],c.coordinate&&(b={},b.x=c.x,b.scoreMean=c.scoreMean,b.y=c.y,b.winrate=c.winrate,b.playouts=c.playouts,b.percentplayouts=c.percentplayouts,b.type="BM",this.board.addObject(b));a._last_mark=!1}},d=function(){var b=document.getElementById("main");a.mainWidth=b.offsetWidth;a.mainHeight=b.offsetHeight;if(a.isWideMode){var c=document.getElementById("main");c.style.margin=
"0px 0px 0px 20px";c.style.top="0px";b=document.getElementById("commenttitile");b.style.display="";if(.7*a.mainWidth>a.mainHeight){c=Math.round(100*a.mainHeight/a.mainWidth);a.positionPercent=c;b=document.getElementsByClassName("wgo-player-center");for(var f=0;f<b.length;f++)b[f].style.width=c+"%";var d=document.getElementsByClassName("wgo-player-right");for(f=0;f<d.length;f++)d[f].style.width=100-c+"%",d[f].style.display="";c=document.getElementsByClassName("wgo-ctrlgroup-left");for(f=0;f<b.length;f++)c[f].style.paddingLeft=
"1%";f=document.getElementById("last");f.style.padding="0px 0px 0px 32px"}else{a.positionPercent=!1;b=document.getElementsByClassName("wgo-player-center");for(f=0;f<b.length;f++)b[f].style.width="70%";d=document.getElementsByClassName("wgo-player-right");for(f=0;f<d.length;f++)d[f].style.width="30%",d[f].style.display="";f=document.getElementById("last");f.style.padding="0px 0px 0px 23px"}}else{a.positionPercent=!1;b=document.getElementById("commenttitile");b.style.display="none";b=document.getElementsByClassName("wgo-player-center");
for(f=0;f<b.length;f++)b[f].style.width="";c=document.getElementsByClassName("wgo-ctrlgroup-left");for(f=0;f<b.length;f++)c[f].style.paddingLeft="0px";if(a.isPC){b=document.getElementsByTagName("button");for(f=0;f<b.length;f++)b[f].className.startsWith("wgo-button3")?b[f].style.width=Math.min(a.mainWidth/17,40)+"px":b[f].className.startsWith("wgo-button2")?(b[f].style.width=Math.min(a.mainWidth/13,55)+"px",b[f].style.fontSize=Math.min(a.mainWidth/18.5,60)/4+"px"):b[f].className.startsWith("wgo-button")&&
(b[f].style.width=Math.min(a.mainWidth/13,65)+"px");c=document.getElementById("main");c.style.margin="0px 0px 0px 0px";c.style.top="-8px";f=document.getElementById("last");f.style.padding="0px 0px 0px 0px"}}if(a.isWideMode)for(b=document.getElementsByTagName("button"),c=Math.min(.7*a.mainWidth,a.mainHeight),f=0;f<b.length;f++)b[f].className.startsWith("wgo-button3")?b[f].style.width=Math.min(c/18,40)+"px":b[f].className.startsWith("wgo-button2")?(b[f].style.width=Math.min(c/13,55)+"px",b[f].style.fontSize=
Math.min(c/15,55)/4+"px"):b[f].className.startsWith("wgo-button")&&(b[f].style.width=Math.min(c/13,60)+"px");else if(a.isPC)for(b=document.getElementsByTagName("button"),f=0;f<b.length;f++)b[f].className.startsWith("wgo-button3")?b[f].style.width=Math.min(a.mainWidth/17,40)+"px":b[f].className.startsWith("wgo-button2")?(b[f].style.width=Math.min(a.mainWidth/13,55)+"px",b[f].style.fontSize=Math.min(a.mainWidth/18.5,60)/4+"px"):b[f].className.startsWith("wgo-button")&&(b[f].style.width=Math.min(a.mainWidth/
13,65)+"px");if(!a.isPC&&!a.isWideMode){b=document.getElementsByTagName("button");for(f=0;f<b.length;f++)b[f].className.startsWith("wgo-button3")?b[f].style.width=Math.min((a.mainWidth-81)/11,60)+"px":b[f].className.startsWith("wgo-button2")?b[f].style.width=Math.min((a.mainWidth-81)/11,60)+"px":b[f].className.startsWith("wgo-button")&&(b[f].style.width=Math.min((a.mainWidth-81)/7,70)+"px");document.getElementById("multiprev").style.width=Math.min((a.mainWidth-81)/9,60)+"px";document.getElementById("multinext").style.width=
Math.min((a.mainWidth-81)/9,60)+"px";document.getElementById("bottommenu").style.width=Math.min((a.mainWidth-81)/13.5,60)+"px"}};a.updatePosition=d;var m=function(){for(var b=a.mianKifu.root,c=1;b.children&&b.children[0];){if(b.bestMoves&&b.bestMoves[0]&&b.children[0].bestMoves&&b.children[0].bestMoves[0]){var f=100-b.children[0].bestMoves[0].winrate-b.bestMoves[0].winrate,d={},e={};if(a.isKataData&&b.bestMoves[0].scoreMean&&b.children[0].bestMoves[0].scoreMean)var g=-b.children[0].bestMoves[0].scoreMean-
b.bestMoves[0].scoreMean;b.move.c==a.W?(a.badMoveListB||(a.badMoveListB=[]),20>a.badMoveListB.length?(d.moveNum=c,d.winrateDiff=f,a.badMoveListB.push(d)):(a.badMoveListB=a.badMoveListB.sort(function(a,b){return a.winrateDiff-b.winrateDiff}),f<a.badMoveListB[19].winrateDiff&&(a.badMoveListB[19].winrateDiff=f,a.badMoveListB[19].moveNum=c)),g&&(a.badMoveListBS||(a.badMoveListBS=[]),20>a.badMoveListBS.length?(e.moveNum=c,e.scoreDiff=g,a.badMoveListBS.push(e)):(a.badMoveListBS=a.badMoveListBS.sort(function(a,
b){return a.scoreDiff-b.scoreDiff}),g<a.badMoveListBS[19].scoreDiff&&(a.badMoveListBS[19].scoreDiff=g,a.badMoveListBS[19].moveNum=c)))):(a.badMoveListW||(a.badMoveListW=[]),20>a.badMoveListW.length?(d.moveNum=c,d.winrateDiff=f,a.badMoveListW.push(d)):(a.badMoveListW=a.badMoveListW.sort(function(a,b){return a.winrateDiff-b.winrateDiff}),f<a.badMoveListW[19].winrateDiff&&(a.badMoveListW[19].winrateDiff=f,a.badMoveListW[19].moveNum=c)),g&&(a.badMoveListWS||(a.badMoveListWS=[]),20>a.badMoveListWS.length?
(e.moveNum=c,e.scoreDiff=g,a.badMoveListWS.push(e)):(a.badMoveListWS=a.badMoveListWS.sort(function(a,b){return a.scoreDiff-b.scoreDiff}),g<a.badMoveListWS[19].scoreDiff&&(a.badMoveListWS[19].scoreDiff=g,a.badMoveListWS[19].moveNum=c))))}c++;b=b.children[0]}a.badMoveListB&&(a.badMoveListB=a.badMoveListB.sort(function(a,b){return a.winrateDiff-b.winrateDiff}));a.badMoveListW&&(a.badMoveListW=a.badMoveListW.sort(function(a,b){return a.winrateDiff-b.winrateDiff}));a.badMoveListBS&&(a.badMoveListBS=a.badMoveListBS.sort(function(a,
b){return a.scoreDiff-b.scoreDiff}));a.badMoveListWS&&(a.badMoveListWS=a.badMoveListWS.sort(function(a,b){return a.scoreDiff-b.scoreDiff}))};l.prototype={constructor:l,init:function(){this.kifu=null;this.listeners={kifuLoaded:[k.bind(this)],update:[h.bind(this)],frozen:[],unfrozen:[]};this.config.kifuLoaded&&this.addEventListener("kifuLoaded",this.config.kifuLoaded);this.config.update&&this.addEventListener("update",this.config.update);this.config.frozen&&this.addEventListener("frozen",this.config.frozen);
this.config.unfrozen&&this.addEventListener("unfrozen",this.config.unfrozen);a.isPC&&this.board.addEventListener("click",w.bind(this));a.isPC?(this.board.addEventListener("mousemove",x.bind(this)),this.board.addEventListener("click",B.bind(this))):this.board.addEventListener("click",A.bind(this));a.curBoard=this.board;this.element.addEventListener("click",this.focus.bind(this));this.focus()},initGame:function(){this.config.sgf?this.loadSgf(this.config.sgf,this.config.move):this.config.json?this.loadJSON(this.config.json,
this.config.move):this.config.sgfFile&&this.loadSgfFromFile(this.config.sgfFile,this.config.move);d()},update:function(a){this.kifuReader&&this.kifuReader.change&&(a={type:"update",op:a,target:this,node:this.kifuReader.node,position:this.kifuReader.getPosition(),path:this.kifuReader.path,change:this.kifuReader.change},this.dispatchEvent(a))},loadKifu:function(b,c){this.kifu=b;this.kifuReader=new a.KifuReader(this.kifu,this.config.rememberPath,this.config.allowIllegalMoves);this.dispatchEvent({type:"kifuLoaded",
target:this,kifu:this.kifu});this.update("init");c&&this.goTo(c)},loadSgf:function(b,c){try{this.loadKifu(a.Kifu.fromSgf(b),c),m()}catch(f){this.error(f)}},loadJSON:function(b,c){try{this.loadKifu(a.Kifu.fromJGO(b),c)}catch(f){this.error(f)}},loadSgfFromFile:function(a,c){var b=this;try{n(a,function(a){b.loadSgf(a,c)})}catch(q){this.error(q)}},addEventListener:function(a,c){this.listeners[a]=this.listeners[a]||[];this.listeners[a].push(c)},removeEventListener:function(a,c){this.listeners[a]&&(c=this.listeners[a].indexOf(c),
-1!=c&&this.listeners[a].splice(c,1))},dispatchEvent:function(a){if(this.listeners[a.type])for(var b in this.listeners[a.type])this.listeners[a.type][b](a)},notification:function(a){console&&a&&console.log(a)},help:function(a){console&&console.log(a)},error:function(b){if(!a.ERROR_REPORT)throw b;console&&console.log(b)},next_edit:function(b){a.lastX=-1;a.lastY=-1;a.isMouseOnBestMove=!1;a.editMode&&a.curBoard.removeAllObjectsOutLine();try{this.kifuReader.next(b),this.update()}catch(v){this.error(v)}},
next:function(b){a.lastNext=!0;a.lastPrev=!1;if(!this.frozen&&this.kifu)if(a.editMode&&a.curBoard.removeAllObjectsOutLine(),a._last_mark&&a.isMouseOnBestMove)a.display_var_length&&(0>a.display_var_length?a.display_var_length=a.commentVarClicked?1:2:a.display_var_length<a.var_length&&a.display_var_length++),this.board.redrawVar();else{a.lastX=-1;a.lastY=-1;try{this.kifuReader.next(b),this.update()}catch(v){this.error(v)}}},previous:function(){a.lastNext=!1;a.lastPrev=!0;if(!this.frozen&&this.kifu)if(a.editMode&&
a.curBoard.removeAllObjectsOutLine(),a._last_mark&&a.isMouseOnBestMove)a.display_var_length&&(0>a.display_var_length?a.display_var_length=a.var_length-1:1<a.display_var_length&&a.display_var_length--),this.board.redrawVar();else{a.lastX=-1;a.lastY=-1;try{this.kifuReader.previous(),this.update()}catch(b){this.error(b)}}},last:function(){if(!this.frozen&&this.kifu)try{this.kifuReader.last(),this.update()}catch(b){this.error(b)}},first:function(){if(!this.frozen&&this.kifu)try{this.kifuReader.first(),
this.update()}catch(b){this.error(b)}},goTo:function(b){if(!this.frozen&&this.kifu){a.editMode&&a.curBoard.removeAllObjectsOutLine();"function"==typeof b&&(b=b.call(this));if("number"==typeof b){var c=a.clone(this.kifuReader.path);c.m=b||0}else c=b;try{this.kifuReader.goTo(c),this.update()}catch(f){this.error(f)}}},goToForBads:function(b){if(!this.frozen&&this.kifu){a.editMode&&a.curBoard.removeAllObjectsOutLine();if("number"==typeof b){b--;var c=a.clone(this.kifuReader.path);c.m=b||0}else c=b;try{this.kifuReader.goTo(c),
this.update()}catch(f){this.error(f)}b=a.curNode.children[0].move;c={};c.c=a.mainGame.turn;c.x=b.x;c.y=b.y;c.type="CR";this.board.addObject(c);a.badLastMark=c}},getGameInfo:function(){if(!this.kifu)return null;var b={},c;for(c in this.kifu.info)-1!=a.Kifu.infoList.indexOf(c)&&(a.Kifu.infoFormatters[c]?b[a.t(c)]=a.Kifu.infoFormatters[c](this.kifu.info[c]):b[a.t(c)]=a.filterHTML(this.kifu.info[c]));return b},setFrozen:function(a){this.frozen=a;this.dispatchEvent({type:this.frozen?"frozen":"unfrozen",
target:this})},appendTo:function(a){a.appendChild(this.element)},focus:function(){this.config.enableKeys&&this.setKeys(!0)},setKeys:function(a){document.onkeydown=a?g.bind(this):null},setWheel:function(a){!this._wheel_listener&&a?(this._wheel_listener=e.bind(this),a=void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",this.element.addEventListener(a,this._wheel_listener)):this._wheel_listener&&!a&&(a=void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",this.element.removeEventListener(a,
this._wheel_listener),delete this._wheel_listener)},setOpenKey:function(){document.addEventListener("keyup",z,!0)},setCoordinates:function(b){!this.coordinates&&b?(this.board.setSection(-.5,-.5,-.5,-.5),this.board.addCustomObject(a.Board.coordinates)):this.coordinates&&!b&&(this.board.setSection(0,0,0,0),this.board.removeCustomObject(a.Board.coordinates));this.coordinates=b}};l.default={sgf:void 0,json:void 0,sgfFile:void 0,move:void 0,board:{},enableWheel:!0,lockScroll:!0,enableKeys:!0,rememberPath:!0,
kifuLoaded:void 0,update:void 0,frozen:void 0,unfrozen:void 0,allowIllegalMoves:!1,markLastMove:!0,displayVariations:!0};a.Player=l;var z=function(b){79==b.which&&document.getElementById("up").click();67==b.which&&a.curPlayer.setCoordinates(!a.curPlayer.coordinates);77==b.which&&a.toggleShowMoveNum(a.curPlayer);88==b.which&&a.togglePoScoreMean();86==b.which&&a.toggleTryPlay(a.curPlayer);65==b.which&&a.toggleAutoPlay()},D={"about-text":"<h1>WGo.js Player 2.0</h1><p>WGo.js Player is extension of WGo.js, HTML5 library for purposes of game of go. It allows to replay go game records and it has many features like score counting. It is also designed to be easily extendable.</p><p>WGo.js is open source licensed under <a href='http://en.wikipedia.org/wiki/MIT_License' target='_blank'>MIT license</a>. You can use and modify any code from this project.</p><p>You can find more information at <a href='http://wgo.waltheri.net/player' target='_blank'>wgo.waltheri.net/player</a></p><p>Copyright &copy; 2013 Jan Prokop</p>",
black:"Black",white:"White",DT:"Date",KM:"Komi",HA:"Handicap",AN:"Annotations",CP:"Copyright",GC:"Game comments",GN:"Game name",ON:"Fuseki",OT:"Overtime",TM:"Basic time",RE:"Result",RO:"Round",RU:"Rules",US:"Recorder",PC:"Place",EV:"Event",SO:"Source",none:"none",bpass:"Black passed.",wpass:"White passed."},c;for(c in D)a.i18n.en[c]=D[c]})(WGo);(function(a){var r=0,n=function(a,g,h){var e={};e.element=document.createElement("div");e.element.className="wgo-player-"+a;e.wrapper=document.createElement("div");e.wrapper.className="wgo-player-"+a+"-wrapper";e.element.appendChild(e.wrapper);g.appendChild(e.element);h||(e.element.style.display="none");return e},h=function(a){var e;if(e=this.currentLayout.layout?this.currentLayout.layout[a]:this.currentLayout[a]){this.regions[a].element.style.display="block";e.constructor!=Array&&(e=[e]);for(var h in e)this.components[e[h]]||
(this.components[e[h]]=new k.component[e[h]](this)),this.components[e[h]].appendTo(this.regions[a].wrapper),this.components[e[h]]._detachFromPlayer=!1}else this.regions[a].element.style.display="none"},k=a.extendClass(a.Player,function(e,g){function h(a){a.preventDefault()}this.config=g;for(var l in k.default)void 0===this.config[l]&&void 0!==k.default[l]&&(this.config[l]=k.default[l]);for(l in a.Player.default)void 0===this.config[l]&&void 0!==a.Player.default[l]&&(this.config[l]=a.Player.default[l]);
this.element=e;this.element.innerHTML="";this.classes=(this.element.className?this.element.className+" ":"")+"wgo-player-main";this.element.className=this.classes;this.element.id||(this.element.id="wgo_"+r++);this.dom={};this.dom.center=document.createElement("div");this.dom.center.className="wgo-player-center";this.dom.board=document.createElement("div");this.dom.board.className="wgo-player-board";this.regions={};this.regions.left=n("left",this.element);this.element.appendChild(this.dom.center);
this.regions.right=n("right",this.element);this.regions.top=n("top",this.dom.center);this.dom.center.appendChild(this.dom.board);this.regions.bottom=n("bottom",this.dom.center);this.board=new a.Board(this.dom.board,this.config.board);this.init();this.components={};window.addEventListener("resize",function(){a.updatePosition();this.noresize||this.updateDimensions();a.drawWinrate();a.drawWinrate2()}.bind(this));(function(){var e=document.documentElement.clientWidth,g=document.documentElement.clientHeight,
l=document.getElementById("main");a.isWideMode=g>e?!1:!0;a.isWideMode?(l.style.height=a.isWideMode?"100%":"96%",l.style.width="100%",a.trueScale=1,document.body.style.zoom=1):(g/=980,e/=g,l.style.height="934px",l.style.width="100%",document.body.style.zoom=g,a.trueScale=g,a.isWideMode||(a.commentheight=a.isPC?Math.max(845-e,185):Math.max(843-e,185)));a.mainWidth=l.offsetWidth;a.mainHeight=l.offsetHeight;document.body.addEventListener("touchmove",h,!1);if(a.isPC)for(l=document.getElementsByClassName("downbutton"),
e=0;e<l.length;e++)l[e].style.border="none"})();this.updateDimensions();this.initGame()});k.prototype.appendTo=function(a){a.appendChild(this.element);this.updateDimensions()};k.prototype.updateDimensions=function(){for(var a=window.getComputedStyle(this.element),g=[];this.element.firstChild;)g.push(this.element.firstChild),this.element.removeChild(this.element.firstChild);var p=parseInt(a.width),l=parseInt(a.height),n=parseInt(a.maxHeight)||0;for(a=0;a<g.length;a++)this.element.appendChild(g[a]);
if(p!=this.width||l!=this.height||n!=this.maxHeight){this.width=p;this.height=l;this.maxHeight=n;a:if(g=this.config.layout,g.constructor==Array){p=this.height||this.maxHeight;for(l=0;l<g.length;l++)if(!g[l].conditions||!(g[l].conditions.minWidth&&!(g[l].conditions.minWidth<=this.width)||g[l].conditions.minHeight&&p&&!(g[l].conditions.minHeight<=p)||g[l].conditions.maxWidth&&!(g[l].conditions.maxWidth>=this.width)||g[l].conditions.maxHeight&&p&&!(g[l].conditions.maxHeight>=p)||g[l].conditions.custom&&
!g[l].conditions.custom.call(this))){g=g[l];break a}g=void 0}if((this.currentLayout=g)&&this.lastLayout!=this.currentLayout){this.element.className=this.currentLayout.className?this.classes+" "+this.currentLayout.className:this.classes;for(var k in this.components)this.components[k]._detachFromPlayer=!0;h.call(this,"left");h.call(this,"right");h.call(this,"top");h.call(this,"bottom");for(k in this.components)this.components[k]._detachFromPlayer&&this.components[k].element.parentNode&&this.components[k].element.parentNode.removeChild(this.components[k].element);
this.lastLayout=this.currentLayout}g=this.dom.board.clientWidth;(k=this.height||this.maxHeight)&&(k-=this.regions.top.element.offsetHeight+this.regions.bottom.element.offsetHeight);k&&k<g?k!=this.board.height&&this.board.setHeight(k):g!=this.board.width&&this.board.setWidth(g);g=k-g;0<g?(this.dom.board.style.height=k+"px",this.dom.board.style.paddingTop=g/2+"px"):(this.dom.board.style.height="auto",this.dom.board.style.paddingTop="0");this.regions.left.element.style.height=this.dom.center.offsetHeight+
"px";this.regions.right.element.style.height=this.dom.center.offsetHeight+"px";for(a in this.components)this.components[a].updateDimensions&&this.components[a].updateDimensions()}};window.addEventListener("orientationchange",function(){k.default=document.documentElement.clientHeight>document.documentElement.clientWidth?{layout:k.layouts.one_column}:{layout:k.dynamicLayout};location.reload(!1)},!1);k.prototype.showMessage=function(e,g,h){this.info_overlay=document.createElement("div");this.info_overlay.style.width=
this.element.offsetWidth+"px";this.info_overlay.style.height=this.element.offsetHeight+"px";this.info_overlay.className="wgo-info-overlay";this.element.appendChild(this.info_overlay);var l=document.createElement("div");l.className="wgo-info-message";l.innerHTML=e;e=document.createElement("div");e.className="wgo-info-close";h||(e.innerHTML=a.t("BP:closemsg"));l.appendChild(e);this.info_overlay.appendChild(l);g?this.info_overlay.addEventListener("click",function(a){g(a)}):h||this.info_overlay.addEventListener("click",
function(a){this.hideMessage()}.bind(this));this.setFrozen(!0)};k.prototype.hideMessage=function(){this.element.removeChild(this.info_overlay);this.setFrozen(!1)};k.prototype.error=function(e){if(!a.ERROR_REPORT)throw e;switch(e.name){case "InvalidMoveError":this.showMessage("<h1>"+e.name+"</h1><p>"+e.message+'</p><p>If this message isn\'t correct, please report it by clicking <a href="#">here</a>, otherwise contact maintainer of this site.</p>');break;case "FileError":this.showMessage("<h1>"+e.name+
"</h1><p>"+e.message+"</p><p>Please contact maintainer of this site. Note: it is possible to read files only from this host.</p>");break;default:this.showMessage("<h1>"+e.name+"</h1><p>"+e.message+"</p><pre>"+e.stacktrace+'</pre><p>Please contact maintainer of this site. You can also report it <a href="#">here</a>.</p>')}};k.component={};k.layouts={one_column:{top:[],bottom:[]},no_comment:{top:[],bottom:[]},right_top:{top:[],right:[],bottom:[]},right:{right:[]},minimal:{bottom:[]}};k.dynamicLayout=
[{conditions:{minWidth:650},layout:k.layouts.right_top,className:"wgo-twocols wgo-large"},{conditions:{minWidth:550,minHeight:600},layout:k.layouts.one_column,className:"wgo-medium"},{conditions:{minWidth:350},layout:k.layouts.no_comment,className:"wgo-small"},{layout:k.layouts.no_comment,className:"wgo-xsmall"}];k.default=document.documentElement.clientHeight>document.documentElement.clientWidth?{layout:k.layouts.one_column}:{layout:k.dynamicLayout};a.i18n.en["BP:closemsg"]="click anywhere to close this window";
k.attributes={"data-wgo":function(a){a&&("("==a[0]?this.sgf=a:this.sgfFile=a)},"data-wgo-board":function(a){this.board=eval("({"+a+"})")},"data-wgo-onkifuload":function(a){this.kifuLoaded=new Function(a)},"data-wgo-onupdate":function(a){this.update=new Function(a)},"data-wgo-onfrozen":function(a){this.frozen=new Function(a)},"data-wgo-onunfrozen":function(a){this.unfrozen=new Function(a)},"data-wgo-layout":function(a){this.layout=eval("({"+a+"})")},"data-wgo-enablewheel":function(a){"false"==a.toLowerCase()&&
(this.enableWheel=!1)},"data-wgo-lockscroll":function(a){"false"==a.toLowerCase()&&(this.lockScroll=!1)},"data-wgo-enablekeys":function(a){"false"==a.toLowerCase()&&(this.enableKeys=!1)},"data-wgo-rememberpath":function(a){"false"==a.toLowerCase()&&(this.rememberPath=!1)},"data-wgo-allowillegal":function(a){"false"!=a.toLowerCase()&&(this.allowIllegalMoves=!0)},"data-wgo-move":function(a){var e=parseInt(a);isNaN(e)?this.move=eval("({"+a+"})"):this.move=e},"data-wgo-marklastmove":function(a){"false"==
a.toLowerCase()&&(this.markLastMove=!1)},"data-wgo-diagram":function(a){a&&("("==a[0]?this.sgf=a:this.sgfFile=a,this.enableWheel=this.enableKeys=this.markLastMove=!1,this.layout={top:[],right:[],left:[],bottom:[]})}};var p=function(a){var e={};for(var h=0;h<a.attributes.length;h++){var l=a.attributes[h];k.attributes[l.name]&&k.attributes[l.name].call(e,l.value,l.name)}l=new k(a,e);a._wgo_player=l};a.BasicPlayer=k;a.player_from_tag=p;window.addEventListener("load",function(){setTimeout(function(){for(var a=
document.querySelectorAll("[data-wgo],[data-wgo-diagram]"),g=0;g<a.length;g++)p(a[g])},300)})})(WGo);(function(a,r){r=function(){this.element=document.createElement("div")};r.prototype={constructor:r,appendTo:function(a){a.appendChild(this.element)},getWidth:function(){var a=window.getComputedStyle(this.element);return parseInt(a.width)},getHeight:function(){var a=window.getComputedStyle(this.element);return parseInt(a.height)},updateDimensions:function(){}};a.BasicPlayer.component.Component=r})(WGo);(function(){var a=function(a){this[a]={};var e=this[a];e.box=document.createElement("div");e.box.className="wgo-box-wrapper wgo-player-wrapper wgo-"+a;e.name=document.createElement("div");e.name.className="wgo-box-title";e.name.innerHTML=a;e.box.appendChild(e.name);a=document.createElement("div");a.className="wgo-player-info";e.box.appendChild(a);e.info={};e.info.rank=r("rank");e.info.rank.val.innerHTML="-";e.info.caps=r("caps");e.info.caps.val.innerHTML="0";e.info.time=r("time");e.info.time.val.innerHTML=
"--:--";a.appendChild(e.info.rank.wrapper);a.appendChild(e.info.caps.wrapper);a.appendChild(e.info.time.wrapper)},r=function(a){var e={};e.wrapper=document.createElement("div");e.wrapper.className="wgo-player-info-box-wrapper";WGo.isWideMode||"time"!=a||(e.wrapper.style.display="none");e.box=document.createElement("div");e.box.className="wgo-player-info-box";e.wrapper.appendChild(e.box);e.title=document.createElement("div");e.title.className="wgo-player-info-title";e.title.innerHTML=WGo.t(a);e.box.appendChild(e.title);
e.val=document.createElement("div");e.val.className="wgo-player-info-value";e.box.appendChild(e.val);return e},n=function(a){a=a.kifu.info||{};var e="";a.black?(e+=a.black.name,this.black.name.innerHTML=WGo.filterHTML(a.black.name)||WGo.t("black"),this.black.info.rank.val.innerHTML=WGo.filterHTML(a.black.rank)||"-"):(this.black.name.innerHTML=WGo.t("black"),this.black.info.rank.val.innerHTML="-");a.white?(e=e+" vs "+a.white.name,this.white.name.innerHTML=WGo.filterHTML(a.white.name)||WGo.t("white"),
this.white.info.rank.val.innerHTML=WGo.filterHTML(a.white.rank)||"-"):(this.white.name.innerHTML=WGo.t("white"),this.white.info.rank.val.innerHTML="-");document.getElementsByTagName("title")[0].innerText="Lizzie\u590d\u76d8 "+e;this.black.info.caps.val.innerHTML="0";this.white.info.caps.val.innerHTML="0";a.TM?(this.setPlayerTime("black",a.TM),this.setPlayerTime("white",a.TM)):(this.black.info.time.val.innerHTML="--:--",this.white.info.time.val.innerHTML="--:--");this.updateDimensions()},h=function(a){a.node.BL&&
this.setPlayerTime("black",a.node.BL);a.node.WL&&this.setPlayerTime("white",a.node.WL);void 0!==a.position.capCount.black&&(this.black.info.caps.val.innerHTML=a.position.capCount.black);void 0!==a.position.capCount.white&&(this.white.info.caps.val.innerHTML=a.position.capCount.white)},k=WGo.extendClass(WGo.BasicPlayer.component.Component,function(e){this.super(e);this.element.className="wgo-infobox";a.call(this,"black");a.call(this,"white");this.element.appendChild(this.black.box);if(!WGo.isWideMode){var g=
document.createElement("div");g.className="wgo-box-engine";var p=document.createElement("div");p.className="wgo-box-engine-content";g.appendChild(p);WGo.engineElement=p;this.element.appendChild(g)}this.element.appendChild(this.white.box);e.addEventListener("kifuLoaded",n.bind(this));e.addEventListener("update",h.bind(this))});k.prototype.setPlayerTime=function(a,g){var e=Math.round(g)%60;this[a].info.time.val.innerHTML=Math.floor(g/60)+":"+(10>e?"0"+e:e)};k.prototype.updateDimensions=function(){};
var p=WGo.BasicPlayer.layouts;p.right_top.right.push("InfoBox");p.right.right.push("InfoBox");p.one_column.top.push("InfoBox");p.no_comment.top.push("InfoBox");WGo.i18n.en.rank="Rank";WGo.i18n.en.caps="Caps";WGo.i18n.en.time="Time";WGo.BasicPlayer.component.InfoBox=k})(WGo);(function(a,r){var n=function(){this.box=document.createElement("div");this.box.className="wgo-box-wrapper wgo-comments-wrapper";this.box.onclick=function(){if(!a.commentVarClickedNow&&a.isMouseOnBestMove){a.commentVarClicked=!1;a.lastX=-1;a.lastY=-1;a.clickedComment=!1;a.isMouseOnBestMove=!1;a.curBoard.removeAllObjectsVR();if(a.curNode.children[0]){var c=a.curNode.children[0].move,b={};b.c=a.mainGame.turn;b.x=c.x;b.y=c.y;b.type="CRS";a.curBoard.addObject(b);a.badLastMark2=b}c=a.curNode;if(c.bestMoves)for(b=
0;b<c.bestMoves.length;b++){var d=c.bestMoves[b];if(d.coordinate){var f={};f.x=d.x;f.y=d.y;f.scoreMean=d.scoreMean;f.winrate=d.winrate;f.playouts=d.playouts;f.percentplayouts=d.percentplayouts;f.type="BM";a.curBoard.addObject(f)}}a.editMode||(b={type:"TRS"},b.x=c.move.x,b.y=c.move.y,a.curBoard.addObject(b))}};this.element.appendChild(this.box);a.commentWrapper=this.box;a.commentheight&&(this.box.style.height=a.commentheight+"px");this.comments_title=document.createElement("div");this.comments_title.className=
"wgo-box-title";this.comments_title.id="commenttitile";this.box.appendChild(this.comments_title);a.commentTitle=this.comments_title;this.winratePanel=document.createElement("div");this.winratePanel.className="wgo-comments-winrate";this.box.appendChild(this.winratePanel);a.isPC?(this.winratePanel.addEventListener("mousedown",p),this.winratePanel.addEventListener("mousemove",e),this.winratePanel.addEventListener("mouseup",g)):(this.winratePanel.addEventListener("touchstart",h,!1),this.winratePanel.addEventListener("touchmove",
h,!1),this.winratePanel.addEventListener("touchend",h,!1));a.winratePanel=this.winratePanel;this.winratecanvas=document.createElement("canvas");this.winratecanvas.className="wgo-comments-winrate-canvas";this.winratePanel.appendChild(this.winratecanvas);a.winratecanvas=this.winratecanvas;this.comments=document.createElement("div");this.comments.className="wgo-comments-content";this.box.appendChild(this.comments);a.commentContent=this.comments;this.winratecanvas2=document.createElement("canvas");this.winratecanvas2.className=
"wgo-comments-winrate-canvas2";this.winratePanel.appendChild(this.winratecanvas2);a.winratecanvas2=this.winratecanvas2;this.help=document.createElement("div");this.help.className="wgo-help";this.help.style.display="none";this.comments.appendChild(this.help);this.notification=document.createElement("div");this.notification.className="wgo-notification";this.notification.style.display="none";this.comments.appendChild(this.notification);this.comment_text=document.createElement("div");this.comment_text.className=
"wgo-comment-text";this.comments.appendChild(this.comment_text);a.comment_text=this.comment_text;this.comment_text.style.fontSize=a.isWideMode?"15px":"17px"},h=function(c){c=c||window.event;switch(c.type){case "touchstart":var b=c.touches[0].clientX/a.trueScale;break;case "touchend":b=c.changedTouches[0].clientX/a.trueScale;break;case "touchmove":c.preventDefault(),b=c.touches[0].clientX/a.trueScale}c=a.winrateWidth;var d=a.winrateStartWidth;b<d?a.curPlayer.goTo(1):d>c-d?a.curPlayer.goTo(a.allMoveNum):
a.curPlayer.goTo(Math.round((b-d)/(c-2*d)*a.allMoveNum))},k,p=function(c){var b=a.winrateWidth,d=a.winrateStartWidth;c=c.offsetX/a.trueScale;c<d?a.curPlayer.goTo(1):d>b-d?a.curPlayer.goTo(a.allMoveNum):a.curPlayer.goTo(Math.round((c-d)/(b-2*d)*a.allMoveNum));k=!0},e=function(c){if(k){var b=a.winrateWidth,d=a.winrateStartWidth;c=c.offsetX/a.trueScale;c<d?a.curPlayer.goTo(1):d>b-d?a.curPlayer.goTo(a.allMoveNum):a.curPlayer.goTo(Math.round((c-d)/(b-2*d)*a.allMoveNum));window.getSelection?window.getSelection().removeAllRanges():
document.selection.empty()}},g=function(){k=!1;window.getSelection?window.getSelection().removeAllRanges():document.selection.empty()};a.drawWinrate=function(){var c=a.winratecanvas,b=a.winratePanel.offsetWidth;var d=a.isPC?a.isWideMode?a.commentWrapper.offsetHeight-a.commentTitle.offsetHeight-a.commentContent.offsetHeight:a.commentWrapper.offsetHeight-a.commentContent.offsetHeight:a.isWideMode?a.commentWrapper.offsetHeight-a.commentTitle.offsetHeight-a.commentContent.offsetHeight:c.offsetHeight-
3;a.winratePanel.style.height=d+"px";a.winrateWidth=b;b*=2;d*=2;c.width=b;c.height=d;c.style.width=b/2+"px";c.style.height=d/2+"px";c=c.getContext("2d");c.clearRect(0,0,b,d);c.fillStyle="rgb(165,165,165)";c.fillRect(0,0,parseInt(b),parseInt(d));for(var f=a.mianKifu.root,e=0,g=20;f.children[0];)if(f=f.children[0],e++,a.isKataData&&f.bestMoves&&f.bestMoves[0]&&f.bestMoves[0].scoreMean){var m=Math.abs(f.bestMoves[0].scoreMean);m>g&&(g=m)}a.allMoveNum=e;a.maxScoreMean=g;f=a.isWideMode?Math.min(d,1.5*
b)/120:d/30;m=a.isIPAD?Math.max(Math.round(d/15),32):Math.max(Math.round(d/15),36);c.lineWidth=f/2.3;c.setLineDash([16,16]);c.strokeStyle="rgb(200,200,0)";c.beginPath();c.moveTo(1.5*m,3*d/4);c.lineTo(b,3*d/4);c.stroke();c.closePath();c.beginPath();c.moveTo(1.5*m,d/2);c.lineTo(b,d/2);c.stroke();c.closePath();c.beginPath();c.moveTo(1.5*m,d/4);c.lineTo(b,d/4);c.stroke();c.closePath();c.setLineDash([]);c.fillStyle="rgb(210,210,0)";c.font=3*m/4+"px Calibri";c.fillText("50",4,d/2+Math.max(m,14)/3);c.fillText("75",
4,d/4+Math.max(m,14)/3);c.fillText("25",4,3*d/4+Math.max(m,14)/3);m*=1.5;a.winrateStartWidth=m/2;var l=b-2*m;if(a.isKataData)if(a.DZ)if(a.KW){b=b=a.mianKifu.root;for(var h=0;h<e;h++)if(b=b.children[0],b.bestMoves[0]&&b.bestMoves[0].scoreMean&&b.move.c==a.B){var p=6+(d-12)*(.5-b.bestMoves[0].scoreMean/(2*g));c.strokeStyle="rgb(256,55,255)";c.lineWidth=f;c.beginPath();k?c.moveTo(m+l*h/e,k):c.moveTo(m+l*h/e,p);c.lineTo(m+l*(h+1)/e,p);var k=p;c.stroke();c.closePath()}else k&&(c.strokeStyle="rgb(256,55,255)",
c.lineWidth=f,c.beginPath(),c.moveTo(m+l*h/e,k),c.lineTo(m+l*(h+1)/e,k),c.stroke(),c.closePath())}else{if(a.KB)for(b=b=a.mianKifu.root,h=0;h<e;h++)b=b.children[0],b.bestMoves[0]&&b.bestMoves[0].scoreMean&&b.move.c==a.W?(p=6+(d-12)*(.5-b.bestMoves[0].scoreMean/(2*g)),c.strokeStyle="rgb(256,55,255)",c.lineWidth=f,c.beginPath(),k?c.moveTo(m+l*h/e,k):c.moveTo(m+l*h/e,p),c.lineTo(m+l*(h+1)/e,p),k=p,c.stroke(),c.closePath()):k&&(c.strokeStyle="rgb(256,55,255)",c.lineWidth=f,c.beginPath(),c.moveTo(m+l*h/
e,k),c.lineTo(m+l*(h+1)/e,k),c.stroke(),c.closePath())}else for(b=b=a.mianKifu.root,h=0;h<e;h++)b=b.children[0],b.bestMoves[0]&&b.bestMoves[0].scoreMean?(p=b.move.c==a.B?6+(d-12)*(.5+b.bestMoves[0].scoreMean/(2*g)):6+(d-12)*(.5-b.bestMoves[0].scoreMean/(2*g)),c.strokeStyle="rgb(256,55,255)",c.lineWidth=f,c.beginPath(),k?c.moveTo(m+l*h/e,k):c.moveTo(m+l*h/e,p),c.lineTo(m+l*(h+1)/e,p),k=p,c.stroke(),c.closePath()):k&&(c.strokeStyle="rgb(256,55,255)",c.lineWidth=f,c.beginPath(),c.moveTo(m+l*h/e,k),c.lineTo(m+
l*(h+1)/e,k),c.stroke(),c.closePath());b=b=a.mianKifu.root;if(a.DZ)for(h=0;h<e;h++)if(b=b.children[0],b.bestMoves&&b.bestMoves[0]&&b.bestMoves[0].winrate)if(b.move.c==a.W){z&&(c.strokeStyle="rgb(255,255,255)",c.lineWidth=3.3*f/5,c.beginPath(),c.moveTo(m+l*h/e,z),c.lineTo(m+l*(h+1)/e,z),c.stroke(),c.closePath());k=6+(d-12)*(100-b.bestMoves[0].winrate)/100;c.strokeStyle="rgb(0,0,0)";c.lineWidth=3.3*f/5;c.beginPath();n?c.moveTo(m+l*h/e,n):c.moveTo(m+l*h/e,k);c.lineTo(m+l*(h+1)/e,k);var n=k;c.stroke();
c.closePath()}else{k=6+(d-12)*(100-b.bestMoves[0].winrate)/100;c.strokeStyle="rgb(255,255,255)";c.lineWidth=3.3*f/5;c.beginPath();n?c.moveTo(m+l*h/e,z):c.moveTo(m+l*h/e,k);c.lineTo(m+l*(h+1)/e,k);var z=k;c.stroke();c.closePath();n&&(c.strokeStyle="rgb(0,0,0)",c.lineWidth=3.3*f/5,c.beginPath(),c.moveTo(m+l*h/e,n),c.lineTo(m+l*(h+1)/e,n),c.stroke(),c.closePath())}else z&&(c.strokeStyle="rgb(255,255,255)",c.lineWidth=3.3*f/5,c.beginPath(),c.moveTo(m+l*h/e,z),c.lineTo(m+l*(h+1)/e,z),c.stroke(),c.closePath()),
n&&(c.strokeStyle="rgb(0,0,0)",c.lineWidth=3.3*f/5,c.beginPath(),c.moveTo(m+l*h/e,n),c.lineTo(m+l*(h+1)/e,n),c.stroke(),c.closePath());else for(h=0;h<e;h++)if(b=b.children[0],b.bestMoves&&b.bestMoves[0]&&b.bestMoves[0].winrate){k=b.move.c==a.B?6+(d-12)*b.bestMoves[0].winrate/100:6+(d-12)*(100-b.bestMoves[0].winrate)/100;c.strokeStyle="rgb(0,255,255)";c.lineWidth=3.3*f/5;c.beginPath();w?c.moveTo(m+l*h/e,w):c.moveTo(m+l*h/e,k);c.lineTo(m+l*(h+1)/e,k);var w=k;c.stroke();c.closePath()}else w&&(c.strokeStyle=
"rgb(0,255,0)",c.lineWidth=3.3*f/5,c.beginPath(),c.moveTo(m+l*h/e,w),c.lineTo(m+l*(h+1)/e,w),c.stroke(),c.closePath())};a.drawWinrate2=function(){var c=a.winratecanvas2,b=a.winratePanel.offsetWidth;var d=a.isPC?a.isWideMode?a.commentWrapper.offsetHeight-a.commentTitle.offsetHeight-a.commentContent.offsetHeight:a.commentWrapper.offsetHeight-a.commentContent.offsetHeight:a.isWideMode?a.commentWrapper.offsetHeight-a.commentTitle.offsetHeight-a.commentContent.offsetHeight:a.winratePanel.offsetHeight;
b*=2;d*=2;c.width=b;c.height=d;c.style.width=b/2+"px";c.style.height=d/2+"px";c=c.getContext("2d");c.clearRect(0,0,b,d);var f=a.isIPAD?Math.max(Math.round(d/15),32):Math.max(Math.round(d/15),36),e=1.5*f,g=b-2*e,m=a.curNode,h=a.curPlayer.kifuReader.path.m;c.lineWidth=(a.isWideMode?Math.min(d,1.5*b)/180:d/50)/2;c.setLineDash([16,16]);c.strokeStyle="rgb(255,255,0)";c.beginPath();c.moveTo(e+h/a.allMoveNum*g,0);c.lineTo(e+h/a.allMoveNum*g,d);c.stroke();c.closePath();c.setLineDash([]);if(a.isKataData)if(a.DZ)if(a.KB){if(m.move&&
m.move.c==a.W){if(m.bestMoves&&m.bestMoves[0]&&m.bestMoves[0].scoreMean){var l=6+(d-12)*(.5-m.bestMoves[0].scoreMean/(2*a.maxScoreMean));var k=m.bestMoves[0].scoreMean;a.lscoreHeight=l;a.lsScore=k;var p=!0}}else a.lsScore&&(l=a.lscoreHeight,k=a.lsScore,p=!0);p&&(c.fillStyle="rgb(0,0,255)",c.font="bold "+5*f/6+"px Calibri",b=l<.1*d?l+.75*f:l-.2083*f,k=k.toFixed(1),h<.98*a.allMoveNum?(3==k.length&&c.fillText(k,e+h/a.allMoveNum*g-1.18*f,b),4==k.length&&c.fillText(k,e+h/a.allMoveNum*g-1.59*f,b),5==k.length&&
c.fillText(k,e+h/a.allMoveNum*g-2.05*f,b)):(3==k.length&&c.fillText(k,e+h/a.allMoveNum*g-1.76*f,b),4==k.length&&c.fillText(k,e+h/a.allMoveNum*g-2.22*f,b),5==k.length&&c.fillText(k,e+h/a.allMoveNum*g-2.62*f,b)))}else a.KW&&(m.move&&m.move.c==a.B?m.bestMoves&&m.bestMoves[0]&&m.bestMoves[0].scoreMean&&(l=6+(d-12)*(.5-m.bestMoves[0].scoreMean/(2*a.maxScoreMean)),k=m.bestMoves[0].scoreMean,a.lscoreHeight=l,a.lsScore=k,p=!0):a.lsScore&&(l=a.lscoreHeight,k=a.lsScore,p=!0),p&&(c.fillStyle="rgb(0,0,255)",
c.font="bold "+5*f/6+"px Calibri",b=l<.1*d?l+.75*f:l-.2083*f,k=k.toFixed(1),h<.98*a.allMoveNum?(3==k.length&&c.fillText(k,e+h/a.allMoveNum*g-1.18*f,b),4==k.length&&c.fillText(k,e+h/a.allMoveNum*g-1.59*f,b),5==k.length&&c.fillText(k,e+h/a.allMoveNum*g-2.05*f,b)):(3==k.length&&c.fillText(k,e+h/a.allMoveNum*g-1.76*f,b),4==k.length&&c.fillText(k,e+h/a.allMoveNum*g-2.22*f,b),5==k.length&&c.fillText(k,e+h/a.allMoveNum*g-2.62*f,b))));else m.bestMoves&&m.bestMoves[0]&&m.bestMoves[0].scoreMean&&(m.move.c==
a.B?(l=6+(d-12)*(.5+m.bestMoves[0].scoreMean/(2*a.maxScoreMean)),k=-m.bestMoves[0].scoreMean):(l=6+(d-12)*(.5-m.bestMoves[0].scoreMean/(2*a.maxScoreMean)),k=m.bestMoves[0].scoreMean),c.fillStyle="rgb(0,0,255)",c.font="bold "+5*f/6+"px Calibri",b=l<.1*d?l+.75*f:l-.2083*f,k=k.toFixed(1),h<.98*a.allMoveNum?(3==k.length&&c.fillText(k,e+h/a.allMoveNum*g-1.18*f,b),4==k.length&&c.fillText(k,e+h/a.allMoveNum*g-1.59*f,b),5==k.length&&c.fillText(k,e+h/a.allMoveNum*g-2.05*f,b)):(3==k.length&&c.fillText(k,e+
h/a.allMoveNum*g-1.76*f,b),4==k.length&&c.fillText(k,e+h/a.allMoveNum*g-2.22*f,b),5==k.length&&c.fillText(k,e+h/a.allMoveNum*g-2.62*f,b)));if(m.bestMoves&&m.bestMoves[0]&&m.bestMoves[0].winrate)if(a.DZ){if(m.move.c==a.B){var n=6+(d-12)*(100-m.bestMoves[0].winrate)/100;var z=m.bestMoves[0].winrate;if(m.parent&&m.parent.bestMoves&&m.parent.bestMoves[0]&&m.parent.bestMoves[0].winrate){var w=6+(d-12)*(100-m.parent.bestMoves[0].winrate)/100;var u=m.parent.bestMoves[0].winrate}}else w=6+(d-12)*(100-m.bestMoves[0].winrate)/
100,u=m.bestMoves[0].winrate,m.parent&&m.parent.bestMoves&&m.parent.bestMoves[0]&&m.parent.bestMoves[0].winrate&&(n=6+(d-12)*(100-m.parent.bestMoves[0].winrate)/100,z=m.parent.bestMoves[0].winrate);z&&(m=80<z?n+.95*f:n-.25*f,c.fillStyle="rgb(255,255,255)",c.beginPath(),c.arc(e+h/a.allMoveNum*g,n,f/7,0,2*Math.PI,!0),c.closePath(),c.fill(),c.fillStyle="rgb(255,255,255)",c.font="bold "+f+"px Calibri",h<.98*a.allMoveNum?c.fillText(z.toFixed(1),e+h/a.allMoveNum*g+.15*f,m):c.fillText(z.toFixed(1),e+h/a.allMoveNum*
g-.5*f,m));u&&(m=80<u?w+.95*f:w-.25*f,c.fillStyle="rgb(0,0,0)",c.beginPath(),c.arc(e+h/a.allMoveNum*g,w,f/7,0,2*Math.PI,!0),c.closePath(),c.fill(),c.fillStyle="rgb(0,0,0)",c.font="bold "+f+"px Calibri",h<.98*a.allMoveNum?c.fillText(u.toFixed(1),e+h/a.allMoveNum*g+.15*f,m):c.fillText(u.toFixed(1),e+h/a.allMoveNum*g-.5*f,m));l&&(c.fillStyle="rgb(0,0,255)",c.beginPath(),c.arc(e+h/a.allMoveNum*g,l,f/7,0,2*Math.PI,!0),c.closePath(),c.fill())}else w=m.move.c==a.B?6+(d-12)*m.bestMoves[0].winrate/100:6+(d-
12)*(100-m.bestMoves[0].winrate)/100,c.fillStyle="rgb(0,0,0)",c.font="bold "+f+"px Calibri",u=m.bestMoves[0].winrate,m.move.c==a.B&&(u=100-u),b=80<u?w+.95*f:w-.25*f,h<.98*a.allMoveNum?c.fillText(u.toFixed(1),e+h/a.allMoveNum*g+.15*f,b):c.fillText(u.toFixed(1),e+h/a.allMoveNum*g-.5*f,b),l&&(c.fillStyle="rgb(0,0,255)",c.beginPath(),c.arc(e+h/a.allMoveNum*g,l,f/7,0,2*Math.PI,!0),c.closePath(),c.fill()),c.fillStyle="rgb(0,0,0)",c.beginPath(),c.arc(e+h/a.allMoveNum*g,w,f/7,0,2*Math.PI,!0),c.closePath(),
c.fill()};var w=function(c){if(!a.clickedComment&&!a.commentVarClicked&&(a.curBoard.removeAllObjectsVR(),a.curBoard.removeAllObjectsBM(),a.badLastMark&&this.board.removeObject(a.badLastMark),a.badLastMark2&&this.board.removeObject(a.badLastMark2),c=a.curNode.bestMoves[c],a.lastX!=c.x||a.lastY!=c.y)){a.isMouseOnBestMove=!0;a.mouseBestMove=c;this.board.removeAllObjectsBM(c.x,c.y);var b={};b.c=a.mainGame.turn;b.BMbyComment=!0;b.x=c.x;b.y=c.y;b.winrate=c.winrate;b.scoreMean=c.scoreMean;b.playouts=c.playouts;
b.percentplayouts=c.percentplayouts;b.type="BM";this.board.addObject(b);c=c.variation;for(b=1;b<c.length;b++){var d=c[b].split("_");a.var_length=c.length;this.board.addObject({type:"variation",x:d[0],y:d[1],c:a.mainGame.turn,num:b+1});a.display_var_length=a.isAutoMode?1:-1}a._last_mark=!0}},l=function(c){a.curPlayer.next(c)},u=function(c){a.commentVarClickedNow=!0;setTimeout(function(){a.commentVarClickedNow=!1},100);a.curBoard.removeAllObjectsVR();a.curBoard.removeAllObjectsBM();c=a.curNode.bestMoves[c];
if(a.lastX==c.x&&a.lastY==c.y){a.commentVarClicked=!1;a.clickedComment=!1;a.lastX=-1;a.lastY=-1;a.isMouseOnBestMove=!1;a._last_mark=!1;if(a.curNode.children[0]){c=a.curNode.children[0].move;var b={};b.c=a.mainGame.turn;b.x=c.x;b.y=c.y;b.type="CRS";a.curBoard.addObject(b);a.badLastMark2=b}b=a.curNode;if(b.bestMoves)for(c=0;c<b.bestMoves.length;c++){var d=b.bestMoves[c];if(d.coordinate){var f={};f.x=d.x;f.y=d.y;f.scoreMean=d.scoreMean;f.winrate=d.winrate;f.playouts=d.playouts;f.percentplayouts=d.percentplayouts;
f.type="BM";this.board.addObject(f)}}a.editMode||(c={type:"TRS"},c.x=b.move.x,c.y=b.move.y,this.board.addObject(c))}else{a.commentVarClicked=!0;a.clickedComment=!0;a.lastX=c.x;a.lastY=c.y;a.isMouseOnBestMove=!0;a.mouseBestMove=c;this.board.removeAllObjectsBM(c.x,c.y);a.badLastMark&&this.board.removeObject(a.badLastMark);a.badLastMark2&&this.board.removeObject(a.badLastMark2);f={};f.c=a.mainGame.turn;f.BMbyComment=!0;f.x=c.x;f.y=c.y;f.winrate=c.winrate;f.scoreMean=c.scoreMean;f.playouts=c.playouts;
f.percentplayouts=c.percentplayouts;f.type="BM";this.board.addObject(f);b=c.variation;a.display_var_length=a.isAutoMode?1:-1;for(c=1;c<b.length;c++)f=b[c].split("_"),a.var_length=b.length,this.board.addObject({type:"variation",x:f[0],y:f[1],c:a.mainGame.turn,num:c+1});a._last_mark=!0}},x=function(a,b){a+="";var c=String.fromCharCode(160);return a.length<b?x(c+a,b):a},B=function(){if(!a.commentVarClicked){a.curBoard.removeAllObjectsVR();a.curBoard.removeAllObjectsBM();a.isMouseOnBestMove=!1;if(a.curNode.children[0]){var c=
a.curNode.children[0].move,b={};b.c=a.mainGame.turn;b.x=c.x;b.y=c.y;b.type="CRS";a.curBoard.addObject(b);a.badLastMark2=b}c=a.curNode;if(c.bestMoves)for(b=0;b<c.bestMoves.length;b++){var d=c.bestMoves[b];if(d.coordinate){var f={};f.x=d.x;f.y=d.y;f.scoreMean=d.scoreMean;f.winrate=d.winrate;f.playouts=d.playouts;f.percentplayouts=d.percentplayouts;f.type="BM";this.board.addObject(f)}}a.editMode||(b={type:"TRS"},b.x=c.move.x,b.y=c.move.y,a.curBoard.addObject(b))}},A=function(c,b){for(var d in c)c[d].className&&
"wgo-move-link2"==c[d].className?(c[d].addEventListener("click",l.bind(b,a.commentBindBranchIndex)),a.commentBindBranchIndex++):c[d].className&&"wgo-move-link"==c[d].className?(a.curNode.bestMoves[a.commentBindBestMoveIndex].coordinate&&(a.isPC&&(c[d].addEventListener("mousemove",w.bind(b,a.commentBindBestMoveIndex)),c[d].addEventListener("mouseout",B.bind(b))),c[d].addEventListener("click",u.bind(b,a.commentBindBestMoveIndex))),a.commentBindBestMoveIndex++):c[d].childNodes&&c[d].childNodes.length&&
A(c[d].childNodes,b)},d=function(c,b){var d='<div class="wgo-info-list">';b&&(d+='<div class="wgo-info-title">'+a.t("gameinfo")+"</div>");for(var f in c)d+='<div class="wgo-info-item"><span class="wgo-info-label">'+f+'</span><span class="wgo-info-value">'+c[f]+"</span></div>";return d+"</div>"};r=a.extendClass(a.BasicPlayer.component.Component,function(c){this.super(c);this.player=c;a.curPlayer=c;this.element.className="wgo-commentbox";n.call(this);c.addEventListener("kifuLoaded",function(b){b.node!=
a.mianKifu.root?(this.element.className="wgo-commentbox",this._update=function(b){a.isShowingBadMoves||(this.setComments(b),a.curCommentUpdate=b)}.bind(this),c.addEventListener("update",this._update)):(this.comments_title.innerHTML=a.t("gameinfo"),this.element.className="wgo-commentbox wgo-gameinfo",this._update&&(c.removeEventListener("update",this._update),delete this._update),this.comment_text.innerHTML=d(b.target.getGameInfo()))}.bind(this));c.notification=function(a){a?(this.notification.style.display=
"block",this.notification.innerHTML=a,this.is_notification=!0):(this.notification.style.display="none",this.is_notification=!1)}.bind(this);c.help=function(a){a?(this.help.style.display="block",this.help.innerHTML=a,this.is_help=!0):(this.help.style.display="none",this.is_help=!1)}.bind(this)});r.prototype.setComments=function(c){var b="";c.node.parent||(b=d(c.target.getGameInfo(),!0));this.comment_text.innerHTML=b+this.getCommentText(c.node.comment,c.node.bestMoves,c.node);a.commentBindBestMoveIndex=
0;a.commentBindBranchIndex=0;this.player.config.formatMoves&&this.comment_text.childNodes&&this.comment_text.childNodes.length&&A(this.comment_text.childNodes,this.player)};a.setCommentsMove=function(c){var b="";c.node.parent||(b=d(c.target.getGameInfo(),!0));var e=a.comment_text;var f=c.node.comment;c=c.node.bestMoves;var g="";if(c)for(var m=0;m<c.length;m++)if(c[m]&&c[m].coordinate){g+='<p><a class="wgo-move-link">';var h=D(c[m].playouts),l=x(c[m].coordinate+"",3),k=c[m].playouts/c[m].totalplayouts*
100;g+="\n\u9009\u70b9"+x(m+1,2)+": "+l+"\u3000\u80dc\u7387:"+x(c[m].winrate.toFixed(1),4);c[m].scoreMean&&(g+="\u3000\u76ee\u5dee:"+x(c[m].scoreMean.toFixed(1),5));g+="\u3000\u8ba1\u7b97\u91cf:";if(10>k)g=3>k?g+"\u258e":5>k?g+"\u258b":g+"\u2589";else if(70<k)g+="\u2588\u2588\u2588\u2588\u2588\u2588\u2588";else for(l=0;10*l<k;l++)g+="\u2588";g+=" "+k.toFixed(1)+"% ("+h+")";g+="</a></p>"}c&&c[0]&&(f="<p>"+a.curNode.comment2+"</p>");f=f&&a.isWideMode?"<p>"+f+"</p>"+g:g;f=0<f.length?f:"";e.innerHTML=
b+f;a.commentBindBestMoveIndex=0;a.curPlayer.config.formatMoves&&a.comment_text.childNodes&&a.comment_text.childNodes.length&&A(a.comment_text.childNodes,a.curPlayer)};var m=function(c,b){for(var d="",f=0;f<c.length;f++){d=0==f%2?d+("<p>\u6076\u624b"+(f+1)+':<a class="wgo-move-link">'):d+("\u3000\u3000\u6076\u624b"+(f+1)+':<a class="wgo-move-link">');var e=b?c[f].winrateDiff:c[f].scoreDiff;d+="\u624b\u6570 "+x(c[f].moveNum,3)+" "+(b?"\u80dc\u7387":"\u76ee\u5dee")+" "+x(e.toFixed(1),5);d=0>e?d+"\u2193":
d+"\u2191";d=1==f%2||f==c.length-1?d+"</a></p>":d+"</a>"}a.isShowingBadMoves=!0;return d};a.setBadMove=function(c,b){c?b?(a.comment_text.innerHTML=m(a.badMoveListB,!0),z(a.comment_text.childNodes,a.curPlayer,a.badMoveListB)):(a.comment_text.innerHTML=m(a.badMoveListBS,!1),z(a.comment_text.childNodes,a.curPlayer,a.badMoveListBS)):b?(a.comment_text.innerHTML=m(a.badMoveListW,!0),z(a.comment_text.childNodes,a.curPlayer,a.badMoveListW)):(a.comment_text.innerHTML=m(a.badMoveListWS,!1),z(a.comment_text.childNodes,
a.curPlayer,a.badMoveListWS))};var z=function(c,b,d){a.gotomoveNumber=[];for(var f=0;f<c.length;f++)for(var e=0,g=0;g<c[f].childNodes.length;g++)"wgo-move-link"==c[f].childNodes[g].className&&(c[f].childNodes[g].addEventListener("click",b.goToForBads.bind(b,d[2*f+e].moveNum)),e+=1),a.first=!0},D=function(a){return 1E6<=a?(a/1E5/10).toFixed(1)+"m":1E3<=a?(a/1E3).toFixed(1)+"k":a};r.prototype.getCommentText=function(c,b,d){var f="";if(d.children&&1<d.children.length)for(var e=0;e<d.children.length;e++)0==
e?f+='<p><a class="wgo-move-link2">\u4e3b\u5206\u652f(A)</a>':(f=1==e%5&&1!=e?f+('<p><a class="wgo-move-link2">\u5206\u652f('+String.fromCharCode(65+e)+")"):f+('\u3000\u3000<a class="wgo-move-link2">\u5206\u652f('+String.fromCharCode(65+e)+")"),f=0==e%5||e==d.children.length-1?f+"</a></p>":f+"</a>");if(b)for(d=0;d<b.length;d++)if(b[d]&&b[d].coordinate){f+='<p><a class="wgo-move-link">';var g=D(b[d].playouts);e=x(b[d].coordinate+"",3);var m=b[d].playouts/b[d].totalplayouts*100;f+="\n\u9009\u70b9"+
x(d+1,2)+": "+e+"\u3000\u80dc\u7387:"+x(b[d].winrate.toFixed(1),4);b[d].scoreMean&&(f+="\u3000\u76ee\u5dee:"+x(b[d].scoreMean.toFixed(1),5));f+="\u3000\u8ba1\u7b97\u91cf:";if(10>m)f=3>m?f+"\u258e":5>m?f+"\u258b":f+"\u2589";else if(70<m)f+="\u2588\u2588\u2588\u2588\u2588\u2588\u2588";else for(e=0;10*e<m;e++)f+="\u2588";f+=" "+m.toFixed(1)+"% ("+g+")";f+="</a></p>"}b&&b[0]&&(c="<p>"+a.curNode.comment2+"</p>");c=c&&a.isWideMode?"<p>"+c+"</p>"+f:f;return 0<c.length?c:""};a.BasicPlayer.default.formatNicks=
!0;a.BasicPlayer.default.formatMoves=!0;a.BasicPlayer.attributes["data-wgo-formatnicks"]=function(a){"false"==a.toLowerCase()&&(this.formatNicks=!1)};a.BasicPlayer.attributes["data-wgo-formatmoves"]=function(a){"false"==a.toLowerCase()&&(this.formatMoves=!1)};a.BasicPlayer.layouts.right_top.right.push("CommentBox");a.BasicPlayer.layouts.right.right.push("CommentBox");a.BasicPlayer.layouts.one_column.bottom.push("CommentBox");a.i18n.en.comments="Comments";a.i18n.en.gameinfo="Game info";a.BasicPlayer.component.CommentBox=
r})(WGo);(function(a,r){var n=a.extendClass(a.BasicPlayer.component.Component,function(a){this.super(a);this.widgets=[];this.element.className="wgo-player-control";this.iconBar=document.createElement("div");this.iconBar.className="wgo-control-wrapper";this.element.appendChild(this.iconBar);var d;for(d in n.widgets){var e=new n.widgets[d].constructor(a,n.widgets[d].args);e.appendTo(this.iconBar);this.widgets.push(e)}});n.prototype.updateDimensions=function(){for(var a=navigator.userAgent,e="Android;iPhone;SymbianOS;Windows Phone;iPad;iPod".split(";"),
g=!0,h=0;h<e.length;h++)if(0<a.indexOf(e[h])){g=!1;break}this.element.className=g?"wgo-player-control":"wgo-player-control wgo-440"};var h=a.BasicPlayer.control={},k=function(a){a.node.parent&&this.disabled&&this.enable()},p=function(a){a.node.children.length&&this.disabled&&this.enable()},e=function(a){(this._disabled=this.disabled)||this.disable()},g=function(a){this._disabled||this.enable();delete this._disabled};h.Widget=function(a,e){this.element=this.element||document.createElement(e.type||
"div");this.element.className="wgo-widget-"+e.name;this.init(a,e)};h.Widget.prototype={constructor:h.Widget,init:function(a,e){e&&(e.disabled&&this.disable(),e.init&&e.init.call(this,a))},appendTo:function(a){a.appendChild(this.element)},disable:function(){this.disabled=!0;-1==this.element.className.search("wgo-disabled")&&(this.element.className+=" wgo-disabled")},enable:function(){this.disabled=!1;this.element.className=this.element.className.replace(" wgo-disabled","");this.element.disabled=""}};
h.Group=a.extendClass(h.Widget,function(a,e){this.element=document.createElement("div");this.element.className="wgo-ctrlgroup wgo-ctrlgroup-"+e.name;var d;for(d in e.widgets){var g=new e.widgets[d].constructor(a,e.widgets[d].args);g.appendTo(this.element)}});h.Clickable=a.extendClass(h.Widget,function(a,e){this.super(a,e)});h.Clickable.prototype.init=function(d,e){var g=this;var m=e.togglable?function(){g.disabled||a.editClicked||(e.click.call(g,d)?g.select():g.unselect())}:function(){g.disabled||
e.click.call(g,d)};this.element.addEventListener("click",m);this.element.addEventListener("touchstart",function(a){a.preventDefault();m();e.multiple&&(g._touch_i=0,g._touch_int=window.setInterval(function(){500<g._touch_i&&m();g._touch_i+=100},100));return!1});e.multiple&&this.element.addEventListener("touchend",function(a){window.clearInterval(g._touch_int)});e.disabled&&this.disable();e.init&&e.init.call(this,d)};h.Clickable.prototype.select=function(){this.selected=!0;-1==this.element.className.search("wgo-selected")&&
(this.element.className+=" wgo-selected")};h.Clickable.prototype.unselect=function(){this.selected=!1;this.element.className=this.element.className.replace(" wgo-selected","")};h.Button=a.extendClass(h.Clickable,function(d,e){var g=this.element=document.createElement("button");g.className="wgo-button wgo-button-"+e.name;"multiprev"===e.name&&(g.id="multiprev");"multinext"===e.name&&(g.id="multinext");g.title=a.t(e.name);this.init(d,e)});h.Button2=a.extendClass(h.Clickable,function(d,e){var g=this.element=
document.createElement("button");g.className="wgo-button2 wgo-button2-"+e.name;g.title="menu2"===e.name?a.t("score-po"):a.t(e.name);this.init(d,e)});h.Button3=a.extendClass(h.Clickable,function(d,e){var g=this.element=document.createElement("button");g.className="wgo-button3 wgo-button3-"+e.name;"menu"===e.name&&(g.id="bottommenu");g.title=a.t(e.name);this.init(d,e)});h.Button.prototype.disable=function(){h.Button.prototype.super.prototype.disable.call(this);this.element.disabled="disabled"};h.Button.prototype.enable=
function(){h.Button.prototype.super.prototype.enable.call(this);this.element.disabled=""};h.MenuItem=a.extendClass(h.Clickable,function(d,e){var g=this.element=document.createElement("div");g.className="wgo-menu-item wgo-menu-item-"+e.name;g.title=a.t(e.name);g.innerHTML=g.title;1!=e.badid||a.badMoveListB||(g.style.display="none");2!=e.badid||a.badMoveListBS||(g.style.display="none");3!=e.badid||a.badMoveListW||(g.style.display="none");4!=e.badid||a.badMoveListWS||(g.style.display="none");this.init(d,
e)});h.MenuFile=a.extendClass(h.Clickable,function(d,e){var g=this.element=document.createElement("div");g.className="wgo-menu-item wgo-menu-item-"+e.name;g.title=a.t(e.name);g.innerHTML=g.title;this.init(d,e)});h.MoveNumber=a.extendClass(h.Widget,function(d){this.element=document.createElement("form");this.element.className="wgo-player-mn-wrapper";var e=this.move=document.createElement("input");e.type="text";e.value="0";a.isPC||a.isWideMode||(e.onfocus=function(){e.blur();a.lastNext?d.next():a.lastPrev&&
d.previous()});e.maxlength=3;e.className="wgo-player-mn-value";this.element.appendChild(e);this.element.onsubmit=e.onchange=function(a){a.goTo(this.getValue());return!1}.bind(this,d);d.addEventListener("update",function(a){this.setValue(a.path.m)}.bind(this));d.addEventListener("kifuLoaded",this.enable.bind(this));d.addEventListener("frozen",this.disable.bind(this));d.addEventListener("unfrozen",this.enable.bind(this))});h.MoveNumber.prototype.disable=function(){h.MoveNumber.prototype.super.prototype.disable.call(this);
this.move.disabled="disabled"};h.MoveNumber.prototype.enable=function(){h.MoveNumber.prototype.super.prototype.enable.call(this);this.move.disabled=""};h.MoveNumber.prototype.setValue=function(a){this.move.value=a};h.MoveNumber.prototype.getValue=function(){return parseInt(this.move.value)};var w=function(d){if(d._menu_tmp)delete d._menu_tmp;else{if(!d.menu)for(g in d.menu=document.createElement("div"),d.menu.className="wgo-player-menu",d.menu.style.position="absolute",d.menu.style.display="none",
this.element.parentElement.appendChild(d.menu),n.menu){var e=new n.menu[g].constructor(d,n.menu[g].args,!0);e.appendTo(d.menu)}if("none"!=d.menu.style.display)return d.menu.style.display="none",a.isPC?document.removeEventListener("click",d._menu_ev):document.removeEventListener("touchstart",d._menu_ev),delete d._menu_ev,this.unselect(),!1;d.menu.style.display="block";e=this.element.offsetTop;var g=this.element.offsetLeft;this.element.parentElement.parentElement.parentElement.parentElement==d.regions.bottom.wrapper?
(d.menu.style.left=g+"px",d.menu.style.top=e-d.menu.offsetHeight+1+"px"):(d.menu.style.left=g+"px",d.menu.style.top=e+this.element.offsetHeight+"px");d._menu_ev=w.bind(this,d);d._menu_tmp=!0;a.isPC?document.addEventListener("click",d._menu_ev):document.addEventListener("touchstart",d._menu_ev);return!0}};n.menu=[{constructor:h.MenuItem,args:{name:"\u5173\u4e8e",togglable:!1,click:function(d){d.showMessage(a.t("about-text"))}}},{constructor:h.MenuFile,args:{name:"\u672c\u5730\u68cb\u8c31",togglable:!1,
click:function(){document.getElementById("up").click()}}},{constructor:h.MenuItem,args:{name:"\u67e5\u627e\u6076\u624b(\u9ed1)(\u80dc\u7387)",badid:1,click:function(){a.showBadBlack=!a.showBadBlack;a.showBadWhite&&(a.showBadWhite=!1,a.showBadelemetW.unselect());a.showBadWhiteS&&(a.showBadWhiteS=!1,a.showBadelemetWS.unselect());a.showBadBlackS&&(a.showBadBlackS=!1,a.showBadelemetBS.unselect());a.showBadBlack?(this.select(),a.setBadMove(!0,!0)):(this.unselect(),a.isShowingBadMoves=!1,a.setCommentsMove(a.curCommentUpdate))},
init:function(){a.showBadelemetB=this}}},{constructor:h.MenuItem,args:{name:"\u67e5\u627e\u6076\u624b(\u9ed1)(\u76ee\u5dee)",badid:2,click:function(){a.showBadBlackS=!a.showBadBlackS;a.showBadWhite&&(a.showBadWhite=!1,a.showBadelemetW.unselect());a.showBadWhiteS&&(a.showBadWhiteS=!1,a.showBadelemetWS.unselect());a.showBadBlack&&(a.showBadBlack=!1,a.showBadelemetB.unselect());a.showBadBlackS?(this.select(),a.setBadMove(!0,!1)):(this.unselect(),a.isShowingBadMoves=!1,a.setCommentsMove(a.curCommentUpdate))},
init:function(){a.showBadelemetBS=this}}},{constructor:h.MenuItem,args:{name:"\u67e5\u627e\u6076\u624b(\u767d)(\u80dc\u7387)",badid:3,click:function(){a.showBadWhite=!a.showBadWhite;a.showBadBlack&&(a.showBadBlack=!1,a.showBadelemetB.unselect());a.showBadWhiteS&&(a.showBadWhiteS=!1,a.showBadelemetWS.unselect());a.showBadBlackS&&(a.showBadBlackS=!1,a.showBadelemetBS.unselect());a.showBadWhite?(this.select(),a.setBadMove(!1,!0)):(this.unselect(),a.isShowingBadMoves=!1,a.setCommentsMove(a.curCommentUpdate))},
init:function(){a.showBadelemetW=this}}},{constructor:h.MenuItem,args:{name:"\u67e5\u627e\u6076\u624b(\u767d)(\u76ee\u5dee)",badid:4,click:function(){a.showBadWhiteS=!a.showBadWhiteS;a.showBadBlack&&(a.showBadBlack=!1,a.showBadelemetB.unselect());a.showBadWhite&&(a.showBadWhite=!1,a.showBadelemetW.unselect());a.showBadBlackS&&(a.showBadBlackS=!1,a.showBadelemetBS.unselect());a.showBadWhiteS?(this.select(),a.setBadMove(!1,!1)):(this.unselect(),a.isShowingBadMoves=!1,a.setCommentsMove(a.curCommentUpdate))},
init:function(){a.showBadelemetWS=this}}},{constructor:h.MenuItem,args:{name:"switch-coo",togglable:!0,click:function(a){a.setCoordinates(!a.coordinates);return a.coordinates},init:function(a){a.coordinates&&this.select()}}}];var l,u=function(){a.isKataData&&(a.kataShowMean?(a.menuPoScoreMean.element.innerText="\u76ee\u5dee",a.kataShowMean=!1):(a.menuPoScoreMean.element.innerText="\u8ba1\u7b97\u91cf",a.kataShowMean=!0),a.curBoard.redrawBM())};a.togglePoScoreMean=u;var x=function(d){a.clickedMC=!a.clickedMC;
a.tryPlay.element.innerText=a.clickedMC?"\u8fd4\u56de":"\u8bd5\u4e0b";if(!a.editClicked)if(a.tryPlay._editable=a.tryPlay._editable||new a.Player.Editable(d,d.board),a.tryPlay._editable.set(!a.tryPlay._editable.editMode),a.tryPlay._editable.editMode){if(a.curBoard.removeAllObjectsMoveNum(),a.editMode=!0,a.editMoveNumStart=d.kifuReader.path.m,a.tryPlay._marker&&a.editUnbind?(a.tryPlay._marker._bindEvent(),a.editUnbind=!1):a.tryPlay._marker=new a.Player.Marker(d,d.board),a.isMouseOnBestMove){a.editClicked=
!0;setTimeout(function(){a.editClicked=!1},500);d=a.mouseBestMove.variation;for(var e=0;e<d.length&&e<a.display_var_length;e++){var g=d[e].split("_");a.curPlayer.kifuReader.node.appendChild(new a.KNode({move:{x:parseInt(g[0]),y:parseInt(g[1]),c:a.curPlayer.kifuReader.game.turn},_edited:!0}));a.curPlayer.next_edit(a.curPlayer.kifuReader.node.children.length-1)}a.isMouseOnBestMove=!1}}else a.curBoard.removeAllObjectsMoveNum(),a.curBoard.removeAllObjectsOutLine(),d=a.curNode,e={type:"TRS"},e.x=d.move.x,
e.y=d.move.y,a.curBoard.addObject(e),a.editMode=!1,a.editMoveNumStart=1,a.firsEditPlayed=!1,a.isShowingMoveNum?a.moveMaker&&a.moveMaker._bindEvent():a.tryPlay._marker._unbindEvent()};a.toggleTryPlay=x;var B=function(){l?(clearInterval(l),a.autoPlay.element.innerText="\u81ea\u52a8",l=null,a.isAutoMode=!1):(a.autoPlay.element.innerText="\u505c\u6b62",a.isAutoMode=!0,l=setInterval(function(){a.isMouseOnBestMove&&a.display_var_length&&(0>a.display_var_length?(a.display_var_length=1,a.curBoard.redraw()):
a.display_var_length<a.var_length&&(a.display_var_length++,a.curBoard.redraw()))},700))};a.toggleAutoPlay=B;n.widgets=[{constructor:h.Group,args:{name:"left",widgets:[{constructor:h.Button3,args:{name:"menu",togglable:!0,click:w}}]}},{constructor:h.Group,args:{name:"control",widgets:[{constructor:h.Button2,args:{name:"menu2",click:function(){u()},init:function(){a.menuPoScoreMean=this;this.element.innerText="\u8ba1\u7b97\u91cf";this.element.style.fontSize="12px";a.meanPo=this.element;this.element.style.display=
"none"}}},{constructor:h.Button2,args:{name:"tryplay",click:function(a){x(a)},init:function(){a.tryPlay=this;this.element.innerText="\u8bd5\u4e0b";this.element.style.fontSize="15px"}}},{constructor:h.Button2,args:{name:"autoplay",click:function(){B()},init:function(){a.autoPlay=this;this.element.innerText="\u81ea\u52a8";this.element.style.fontSize="15px"}}},{constructor:h.Button3,args:{name:"first",disabled:!0,init:function(a){a.addEventListener("update",k.bind(this));a.addEventListener("frozen",
e.bind(this));a.addEventListener("unfrozen",g.bind(this))},click:function(a){a.first()}}},{constructor:h.Button3,args:{name:"last",disabled:!0,init:function(a){a.addEventListener("update",p.bind(this));a.addEventListener("frozen",e.bind(this));a.addEventListener("unfrozen",g.bind(this))},click:function(a){a.last()}}},{constructor:h.Button,args:{name:"multiprev",disabled:!1,multiple:!0,init:function(a){a.addEventListener("update",k.bind(this));a.addEventListener("frozen",e.bind(this));a.addEventListener("unfrozen",
g.bind(this))},click:function(d){if(a.isMouseOnBestMove)a.display_var_length=1,a.curBoard.redrawVar();else{var e=a.clone(d.kifuReader.path);e.m-=10;d.goTo(e)}}}},{constructor:h.Button,args:{name:"previous",disabled:!1,multiple:!0,init:function(a){a.addEventListener("update",k.bind(this));a.addEventListener("frozen",e.bind(this));a.addEventListener("unfrozen",g.bind(this))},click:function(a){a.previous()}}},{constructor:h.MoveNumber},{constructor:h.Button,args:{name:"next",disabled:!0,multiple:!0,
init:function(a){a.addEventListener("update",p.bind(this));a.addEventListener("frozen",e.bind(this));a.addEventListener("unfrozen",g.bind(this))},click:function(a){a.next()}}},{constructor:h.Button,args:{name:"multinext",disabled:!0,multiple:!0,init:function(a){a.addEventListener("update",p.bind(this));a.addEventListener("frozen",e.bind(this));a.addEventListener("unfrozen",g.bind(this))},click:function(d){if(a.isMouseOnBestMove)a.display_var_length=a.var_length?a.var_length:1,a.curBoard.redrawVar();
else{var e=a.clone(d.kifuReader.path);e.m+=10;d.goTo(e)}}}}]}}];r=a.BasicPlayer.layouts;r.right_top.bottom.push("Control");r.right.right.push("Control");r.one_column.bottom.push("Control");r.no_comment.bottom.push("Control");r.minimal.bottom.push("Control");r={about:"About",first:"First",multiprev:"10 moves back",previous:"Previous",next:"Next",multinext:"10 moves forward",last:"Last","switch-coo":"Display coordinates",menu:"Menu"};for(var A in r)a.i18n.en[A]=r[A];a.BasicPlayer.component.Control=
n})(WGo);(function(a){var r=function(a,k){this.player.frozen||this._lastX==a&&this._lastY==k||(this._lastX=a,this._lastY=k,this._last_mark&&this.board.removeObject(this._last_mark),-1!=a&&-1!=k&&this.player.kifuReader.game.isValid(a,k)?(this._last_mark={type:"outline",x:a,y:k,c:this.player.kifuReader.game.turn},this.board.addObject(this._last_mark)):delete this._last_mark)},n=function(){this._last_mark&&(this.board.removeObject(this._last_mark),delete this._last_mark,delete this._lastX,delete this._lastY)};
a.Player.Editable={};a.Player.Editable=function(h,k){this.player=h;a.curPlayer=h;this.board=k;this.editMode=!1};a.Player.Editable.prototype.set=function(h){if(!this.editMode&&h)this.originalReader=this.player.kifuReader,this.player.kifuReader=new a.KifuReader(this.player.kifu.clone(),this.originalReader.rememberPath,this.originalReader.allow_illegal,!0),this.player.kifuReader.goTo(this.originalReader.path),this._ev_click=this._ev_click||this.play.bind(this),this._ev_move=this._ev_move||r.bind(this),
this._ev_out=this._ev_out||n.bind(this),this.board.addEventListener("click",this._ev_click),a.isPC&&(this.board.addEventListener("mousemove",this._ev_move),this.board.addEventListener("mouseout",this._ev_out)),this.editMode=!0;else if(this.editMode&&!h){this.originalReader.goTo(this.player.kifuReader.path);h=this.originalReader;for(var k=this.player.kifuReader.getPosition(),p=this.originalReader.getPosition(),e=k.size,g=[],w=[],l=0;l<e*e;l++)k.schema[l]&&!p.schema[l]?w.push({x:Math.floor(l/e),y:l%
e}):k.schema[l]!=p.schema[l]&&g.push({x:Math.floor(l/e),y:l%e,c:p.schema[l]});h.change={add:g,remove:w};this.player.kifuReader=this.originalReader;this.player.update(!0);this.board.removeEventListener("click",this._ev_click);a.isPC&&(this.board.removeEventListener("mousemove",this._ev_move),this.board.removeEventListener("mouseout",this._ev_out));this.editMode=!1}};a.Player.Editable.prototype.play=function(h,k){a.firsEditPlayed||(a.firsEditPlayed=!0,a.editMoveNumStart=a.curPlayer.kifuReader.path.m);
if(a.isMouseOnBestMove&&0<a.display_var_length){h=a.mouseBestMove.variation;for(k=0;k<h.length&&k<a.display_var_length;k++){var p=h[k].split("_");this.player.kifuReader.node.appendChild(new a.KNode({move:{x:parseInt(p[0]),y:parseInt(p[1]),c:this.player.kifuReader.game.turn},_edited:!0}));this.player.next_edit(this.player.kifuReader.node.children.length-1)}a.isMouseOnBestMove=!1}else!this.player.frozen&&this.player.kifuReader.game.isValid(h,k)&&(this.player.kifuReader.node.appendChild(new a.KNode({move:{x:h,
y:k,c:this.player.kifuReader.game.turn},_edited:!0})),this.player.next_edit(this.player.kifuReader.node.children.length-1))};a.BasicPlayer&&a.BasicPlayer.component.Control||(a.i18n.en.editmode="Edit mode")})(WGo);(function(a){var r=function(a,e,g,h){this.originalPosition=a;this.position=a.clone();this.board=e;this.komi=g;this.output=h},n=r.state={UNKNOWN:0,BLACK_STONE:1,WHITE_STONE:-1,BLACK_CANDIDATE:2,WHITE_CANDIDATE:-2,BLACK_NEUTRAL:3,WHITE_NEUTRAL:-3,NEUTRAL:4},h=function(a,e,g,k,l){var p=a.get(e,g);void 0!==p&&p!=k&&p!=l&&(a.set(e,g,k),h(a,e-1,g,k,l),h(a,e,g-1,k,l),h(a,e+1,g,k,l),h(a,e,g+1,k,l))},k=function(a,e,g,h,l){var p=e.get(g,h);a.get(g,h)!=p&&(a.set(g,h,p),k(a,e,g-1,h,l),k(a,e,g,h-1,l),k(a,e,g+
1,h,l),k(a,e,g,h+1,l))};r.prototype.start=function(){this.calculate();this.saved_state=this.board.getState();this.displayScore();this._click=function(p,e){var g=this.originalPosition.get(p,e);g==a.W?this.position.get(p,e)==n.WHITE_STONE?h(this.position,p,e,n.BLACK_CANDIDATE,n.BLACK_STONE):(k(this.position,this.originalPosition,p,e,n.BLACK_STONE),this.calculate()):g==a.B?this.position.get(p,e)==n.BLACK_STONE?h(this.position,p,e,n.WHITE_CANDIDATE,n.WHITE_STONE):(k(this.position,this.originalPosition,
p,e,n.WHITE_STONE),this.calculate()):(g=this.position.get(p,e),g==n.BLACK_CANDIDATE?this.position.set(p,e,n.BLACK_NEUTRAL):g==n.WHITE_CANDIDATE?this.position.set(p,e,n.WHITE_NEUTRAL):g==n.BLACK_NEUTRAL?this.position.set(p,e,n.BLACK_CANDIDATE):g==n.WHITE_NEUTRAL&&this.position.set(p,e,n.WHITE_CANDIDATE));this.board.restoreState({objects:a.clone(this.saved_state.objects)});this.displayScore()}.bind(this);this.board.addEventListener("click",this._click)};r.prototype.end=function(){this.board.restoreState({objects:a.clone(this.saved_state.objects)});
this.board.removeEventListener("click",this._click)};r.prototype.displayScore=function(){for(var h=[],e=[],g=[],k=[],l=[],u=0;u<this.position.size;u++)for(var r=0;r<this.position.size;r++)s=this.position.get(u,r),t=this.originalPosition.get(u,r),s==n.BLACK_CANDIDATE?h.push({x:u,y:r,type:"mini",c:a.B}):s==n.WHITE_CANDIDATE?e.push({x:u,y:r,type:"mini",c:a.W}):s==n.NEUTRAL&&g.push({x:u,y:r}),t==a.W&&s!=n.WHITE_STONE?l.push({x:u,y:r,type:"outline",c:a.W}):t==a.B&&s!=n.BLACK_STONE&&k.push({x:u,y:r,type:"outline",
c:a.B});for(u=0;u<k.length;u++)this.board.removeObjectsAt(k[u].x,k[u].y);for(u=0;u<l.length;u++)this.board.removeObjectsAt(l[u].x,l[u].y);this.board.addObject(l);this.board.addObject(k);this.board.addObject(h);this.board.addObject(e);g="<p style='font-weight: bold;'>"+a.t("RE")+"</p>";u=h.length+l.length+this.originalPosition.capCount.black;r=e.length+k.length+this.originalPosition.capCount.white+parseFloat(this.komi);g+="<p>"+a.t("black")+": "+h.length+" + "+(l.length+this.originalPosition.capCount.black)+
" = "+u+"</br>";g+=a.t("white")+": "+e.length+" + "+(k.length+this.originalPosition.capCount.white)+" + "+this.komi+" = "+r+"</p>";g=u>r?g+("<p style='font-weight: bold;'>"+a.t("bwin",u-r)+"</p>"):g+("<p style='font-weight: bold;'>"+a.t("wwin",r-u)+"</p>");this.output(g)};r.prototype.calculate=function(){var a,e;var g=this.position;for(e=!0;e;){e=!1;for(var h=0;h<g.size;h++)for(var k=0;k<g.size;k++){var r=g.get(k,h);if(r==n.UNKNOWN||r==n.BLACK_CANDIDATE||r==n.WHITE_CANDIDATE){var x=[g.get(k-1,h),
g.get(k,h-1),g.get(k+1,h),g.get(k,h+1)];var B=a=!1;for(var A=0;4>A;A++)x[A]==n.BLACK_STONE||x[A]==n.BLACK_CANDIDATE?a=!0:x[A]==n.WHITE_STONE||x[A]==n.WHITE_CANDIDATE?B=!0:x[A]==n.NEUTRAL&&(B=a=!0);x=!1;a&&B?x=n.NEUTRAL:a?x=n.BLACK_CANDIDATE:B&&(x=n.WHITE_CANDIDATE);x&&r!=x&&(e=!0,g.set(k,h,x))}}}};a.ScoreMode=r;a.BasicPlayer&&a.BasicPlayer.component.Control&&a.BasicPlayer.component.Control.menu.push({constructor:a.BasicPlayer.control.MenuItem,args:{name:"scoremode",togglable:!0,click:function(h){if(this.selected)return h.setFrozen(!1),
this._score_mode.end(),delete this._score_mode,h.notification(),h.help(),!1;h.setFrozen(!0);h.help("<p>"+a.t("help_score")+"</p>");this._score_mode=new a.ScoreMode(h.kifuReader.game.position,h.board,h.kifu.info.KM||.5,h.notification);this._score_mode.start();return!0}}});a.i18n.en.scoremode="Count score";a.i18n.en.score="Score";a.i18n.en.bwin="Black wins by $ points.";a.i18n.en.wwin="White wins by $ points.";a.i18n.en.help_score="Click on stones to mark them dead or alive. You can also set and unset territory points by clicking on them. Territories must be completely bordered."})(WGo);(function(a,r){var n={active:!0,query:{}},h=function(a){try{n.query=JSON.parse('{"'+window.location.hash.substr(1).replace("=",'":')+"}")}catch(e){n.query={}}};window.addEventListener("hashchange",function(){if(""!=window.location.hash&&n.active){h();for(var a in n.query){var e=document.getElementById(a);e&&e._wgo_player&&e._wgo_player.goTo(k)}}});window.addEventListener("DOMContentLoaded",function(){""!=window.location.hash&&n.active&&h()});window.addEventListener("load",function(){if(""!=window.location.hash&&
n.active)for(var a in n.query){var e=document.getElementById(a);if(e&&e._wgo_player){e.scrollIntoView();break}}});var k=function(){if(n.query[this.element.id])return n.query[this.element.id].goto};a.Player.default.move=k;a.BasicPlayer&&a.BasicPlayer.component.Control&&a.BasicPlayer.component.Control.menu.push({constructor:a.BasicPlayer.control.MenuItem,args:{name:"permalink",click:function(h){var e=location.href.split("#")[0]+"#"+h.element.id+'={"goto":'+JSON.stringify(h.kifuReader.path)+"}";h.showMessage("<h1>"+
a.t("permalink")+'</h1><p><input class="wgo-permalink" type="text" value=\''+e+'\' onclick="this.select(); event.stopPropagation()"/></p>')}}});a.Player.permalink=n;a.i18n.en.permalink="Permanent link"})(WGo);
